<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextMimic - AIãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        [v-cloak] { display: none !important; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .loader { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
    <div id="app" v-cloak class="max-w-5xl mx-auto min-h-screen flex flex-col">
        <!-- ãƒŠãƒ“ -->
        <nav class="flex items-center justify-between p-6">
            <div class="flex items-center gap-2 cursor-pointer" @click="goHome">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">M</div>
                <span class="text-xl font-extrabold tracking-tight text-slate-900">TextMimic</span>
            </div>
            <div class="flex items-center gap-4">
                <button @click="showSettingsModal = true" class="text-slate-500 hover:text-slate-800 transition p-2 rounded-lg hover:bg-slate-100" title="è¨­å®š">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </button>

                <!-- Auth Button -->
                <div v-if="!user">
                    <button @click="showAuthModal = true" class="text-sm font-bold text-slate-600 hover:text-slate-900 bg-white border border-slate-200 px-4 py-2 rounded-lg transition hover:bg-slate-50">
                        ãƒ­ã‚°ã‚¤ãƒ³
                    </button>
                </div>
                <div v-else class="flex items-center gap-3">
                    <div class="hidden md:block text-xs font-bold text-right text-slate-500">
                        {{ user.displayName || user.email }}
                    </div>
                    <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden border border-slate-200">
                        <img v-if="user.photoURL" :src="user.photoURL" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-slate-500 font-bold text-xs">{{ user.email?.charAt(0).toUpperCase() }}</div>
                    </div>
                    <button @click="logout" class="text-xs text-slate-400 hover:text-red-500 transition">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>

                <a href="creator.html" class="bg-slate-900 text-white text-sm font-bold px-4 py-2 rounded-lg hover:bg-slate-800 transition">
                    + ä½œã‚‹
                </a>
            </div>
        </nav>

        <main class="flex-1 p-4 md:p-6">
            <transition name="fade" mode="out-in">
                <!-- HOMEç”»é¢ -->
                <div v-if="!currentMaker" key="home">
                    <div class="text-center py-8 md:py-12">
                        <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4 leading-tight">
                            è¨€è‘‰ã‚’éŠã¼ã†ã€‚<br><span class="text-indigo-600">AIãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›</span>
                        </h1>
                    </div>

                    <!-- â‘  å…¬å¼ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ— -->
                    <section class="mb-12">
                        <h2 class="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <span>ğŸ‘‘</span> å…¬å¼ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div 
                                v-for="maker in officialMakers" 
                                :key="maker.id"
                                @click="selectMaker(maker)"
                                class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer group ring-1 ring-indigo-50"
                            >
                                <div class="flex items-start justify-between mb-4">
                                    <span class="text-4xl filter group-hover:scale-110 transition-transform duration-300">{{ maker.emoji }}</span>
                                    <span class="text-xs font-bold px-2 py-1 rounded bg-indigo-100 text-indigo-600 uppercase">OFFICIAL</span>
                                </div>
                                <h3 class="text-lg font-bold text-slate-900 mb-2 group-hover:text-indigo-600">{{ maker.title }}</h3>
                                <p class="text-sm text-slate-500 leading-relaxed">{{ maker.description }}</p>
                            </div>
                        </div>
                    </section>

                    <!-- â‘¡ æ–°ç€ã®æŠ•ç¨¿ (Firebase) -->
                    <section>
                        <h2 class="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <span>âœ¨</span> ã¿ã‚“ãªã®æŠ•ç¨¿ (æ–°ç€)
                        </h2>
                        
                        <div v-if="isFetching" class="text-center py-10">
                            <div class="inline-block loader border-indigo-200 border-t-indigo-600 w-8 h-8"></div>
                        </div>

                        <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div 
                                v-for="maker in userMakers" 
                                :key="maker.id"
                                @click="selectMaker(maker)"
                                class="bg-slate-50 p-6 rounded-2xl shadow-sm border border-slate-200 hover:bg-white hover:shadow-lg transition-all cursor-pointer group"
                            >
                                <div class="flex items-start justify-between mb-4">
                                    <span class="text-4xl filter group-hover:scale-110 transition-transform duration-300">{{ maker.emoji }}</span>
                                    <span class="text-xs font-bold px-2 py-1 rounded bg-slate-200 text-slate-500 uppercase">USER</span>
                                </div>
                                <h3 class="text-lg font-bold text-slate-900 mb-2 group-hover:text-indigo-600 line-clamp-1">{{ maker.title }}</h3>
                                <p class="text-sm text-slate-500 leading-relaxed line-clamp-2">{{ maker.description }}</p>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- PLAYç”»é¢ -->
                <div v-else key="play" class="max-w-2xl mx-auto">
                    <button @click="goHome" class="mb-6 flex items-center text-slate-500 hover:text-indigo-600 transition font-medium">â† ä¸€è¦§ã«æˆ»ã‚‹</button>
                    <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200">
                        <div class="p-8 pb-4 text-center bg-gradient-to-b from-slate-50 to-white">
                            <div class="text-5xl mb-4">{{ currentMaker.emoji }}</div>
                            <h2 class="text-2xl font-bold text-slate-900">{{ currentMaker.title }}</h2>

                            <!-- Remix Origin Credit -->
                            <div v-if="currentMaker.remixOriginId" class="mt-1">
                                <a :href="'?id=' + currentMaker.remixOriginId" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold flex items-center justify-center gap-1">
                                    <span>â™»ï¸ Remix of {{ currentMaker.remixOriginTitle || 'Original' }}</span>
                                </a>
                            </div>

                            <p class="text-slate-500 text-sm mt-2">{{ currentMaker.description }}</p>

                            <!-- Remix This Button -->
                            <div class="mt-4">
                                <a :href="'creator.html?remix_id=' + currentMaker.id" class="text-xs text-slate-400 hover:text-indigo-600 border border-slate-200 px-3 py-1 rounded-full bg-white hover:bg-indigo-50 transition inline-flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2.1l4 4-4 4"/><path d="M3 12.2v-2a4 4 0 0 1 4-4h12.8M7 21.9l-4-4 4-4"/><path d="M21 11.8v2a4 4 0 0 1-4 4H4.2"/></svg>
                                    ã“ã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã‚’ãƒªãƒŸãƒƒã‚¯ã‚¹
                                </a>
                            </div>
                        </div>
                        <div class="p-6 md:p-8 space-y-6">
                            <textarea v-model="inputText" class="w-full h-32 p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all resize-none bg-slate-50" :placeholder="currentMaker.placeholder || 'ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...'"></textarea>
                            <button @click="convertText" :disabled="!inputText || isLoading" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg transition flex justify-center items-center gap-2">
                                <span v-if="isLoading" class="loader"></span>
                                <span v-if="!isLoading">å¤‰æ›ã‚¹ã‚¿ãƒ¼ãƒˆ âš¡</span>
                            </button>
                            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                            <div v-if="outputText" class="bg-indigo-50 rounded-xl p-6 border border-indigo-100 mt-4 animate-fade-in">
                                <div class="text-slate-800 leading-relaxed whitespace-pre-wrap">{{ outputText }}</div>
                                <!-- ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
                                <div class="mt-4 pt-4 border-t border-indigo-200 grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <button @click="shareOnTwitter" class="w-full bg-black text-white font-bold py-3 rounded-xl hover:bg-gray-800 transition flex items-center justify-center gap-2">
                                        <span>ğ• ã§ãƒã‚¹ãƒˆ</span>
                                    </button>
                                    <button @click="generateAndShareImage" :disabled="isGeneratingImage" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <span v-if="isGeneratingImage" class="loader w-4 h-4 border-2"></span>
                                        <span v-else>ğŸ“· ç”»åƒã§ã‚·ã‚§ã‚¢</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Remixes List -->
                    <div v-if="remixes.length > 0" class="mt-8 mb-8">
                        <h3 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">
                            <span>â™»ï¸</span> ã“ã®ä½œå“ã®ãƒªãƒŸãƒƒã‚¯ã‚¹
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div
                                v-for="remix in remixes"
                                :key="remix.id"
                                @click="selectMaker(remix)"
                                class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition cursor-pointer flex items-center gap-3"
                            >
                                <span class="text-2xl">{{ remix.emoji }}</span>
                                <div class="overflow-hidden">
                                    <h4 class="font-bold text-slate-900 text-sm truncate">{{ remix.title }}</h4>
                                    <p class="text-xs text-slate-500 truncate">{{ remix.description }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </transition>
        </main>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="p-6 text-center text-slate-400 text-xs space-y-3 border-t border-slate-200 mt-8">
            <div class="flex justify-center gap-4">
                <button @click="showTermsModal = true" class="hover:text-slate-600 underline">åˆ©ç”¨è¦ç´„</button>
                <button @click="showPrivacyModal = true" class="hover:text-slate-600 underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</button>
                <button @click="showOperatorModal = true" class="hover:text-slate-600 underline">é‹å–¶è€…æƒ…å ±</button>
            </div>
            <p>Â© 2024 TextMimic by Tokyo10104184</p>
        </footer>

        <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div v-if="showAuthModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showAuthModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 relative">
                <button @click="showAuthModal = false" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-2xl">&times;</button>

                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">{{ authMode === 'login' ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²' }}</h2>
                    <p class="text-xs text-slate-500">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦TextMimicã‚’ã‚‚ã£ã¨ä¾¿åˆ©ã«ã€‚</p>
                </div>

                <div class="space-y-4">
                    <button @click="loginWithGoogle" class="w-full bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 shadow-sm">
                        <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        Googleã§{{ authMode === 'login' ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'ç™»éŒ²' }}
                    </button>

                    <div class="relative flex py-2 items-center">
                        <div class="flex-grow border-t border-slate-200"></div>
                        <span class="flex-shrink-0 mx-4 text-slate-400 text-xs font-bold">OR</span>
                        <div class="flex-grow border-t border-slate-200"></div>
                    </div>

                    <!-- Email Form -->
                    <form @submit.prevent="handleEmailAuth" class="space-y-3">
                        <div>
                            <input v-model="email" type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full p-3 border border-slate-300 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none transition" required>
                        </div>
                        <div>
                            <input v-model="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="w-full p-3 border border-slate-300 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none transition" required minlength="6">
                        </div>

                        <button type="submit" :disabled="authLoading" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 rounded-xl transition shadow flex justify-center items-center">
                            <span v-if="authLoading" class="loader w-4 h-4 border-2"></span>
                            <span v-else>{{ authMode === 'login' ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²' }}</span>
                        </button>
                    </form>

                    <div v-if="authError" class="text-red-500 text-xs text-center font-bold bg-red-50 p-2 rounded-lg">
                        {{ authError }}
                    </div>

                    <div class="text-center">
                        <button @click="toggleAuthMode" class="text-indigo-600 text-xs font-bold hover:underline">
                            {{ authMode === 'login' ? 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯ç™»éŒ²' : 'ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ãƒ­ã‚°ã‚¤ãƒ³' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div v-if="showSettingsModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showSettingsModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-slate-900">âš™ï¸ è¨­å®š</h2>
                    <button @click="showSettingsModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">AIãƒ¢ãƒ‡ãƒ«</label>
                        <select v-model="selectedModel" class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none appearance-none">
                            <option v-for="model in availableModels" :key="model.id" :value="model.id">
                                {{ model.name }}
                            </option>
                        </select>
                        <p class="text-xs text-slate-400 mt-2">â€» ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦ç”Ÿæˆé€Ÿåº¦ã‚„å“è³ªãŒç•°ãªã‚Šã¾ã™ã€‚</p>
                    </div>
                </div>

                <div class="mt-8">
                    <button @click="showSettingsModal = false" class="w-full bg-slate-900 text-white font-bold py-3 rounded-xl hover:bg-slate-800 transition">
                        OK
                    </button>
                </div>
            </div>
        </div>

        <!-- åˆ©ç”¨è¦ç´„ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div v-if="showTermsModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showTermsModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">ğŸ“œ åˆ©ç”¨è¦ç´„</h2>
                    <button @click="showTermsModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                <div class="text-sm text-slate-600 space-y-4">
                    <p class="text-xs text-slate-400">æœ€çµ‚æ›´æ–°æ—¥: 2025å¹´12æœˆ11æ—¥</p>
                    
                    <h3 class="font-bold text-slate-800">ç¬¬1æ¡ï¼ˆé©ç”¨ï¼‰</h3>
                    <p>æœ¬è¦ç´„ã¯ã€Tokyo10104184ï¼ˆä»¥ä¸‹ã€Œé‹å–¶è€…ã€ï¼‰ãŒæä¾›ã™ã‚‹ã€ŒTextMimicã€ï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã®åˆ©ç”¨ã«é–¢ã™ã‚‹æ¡ä»¶ã‚’å®šã‚ã‚‹ã‚‚ã®ã§ã™ã€‚</p>
                    
                    <h3 class="font-bold text-slate-800">ç¬¬2æ¡ï¼ˆç¦æ­¢äº‹é …ï¼‰</h3>
                    <p>åˆ©ç”¨è€…ã¯ä»¥ä¸‹ã®è¡Œç‚ºã‚’è¡Œã£ã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>æ³•ä»¤ã¾ãŸã¯å…¬åºè‰¯ä¿—ã«åã™ã‚‹å†…å®¹ã®æŠ•ç¨¿ãƒ»ç”Ÿæˆ</li>
                        <li>ä»–è€…ã®æ¨©åˆ©ï¼ˆè‘—ä½œæ¨©ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ¨©ã€åèª‰ç­‰ï¼‰ã‚’ä¾µå®³ã™ã‚‹è¡Œç‚º</li>
                        <li>çŠ¯ç½ªè¡Œç‚ºã‚’åŠ©é•·ã¾ãŸã¯ä¿ƒé€²ã™ã‚‹å†…å®¹ã®ä½œæˆ</li>
                        <li>è™šå½ã®æƒ…å ±ã‚’æ‹¡æ•£ã™ã‚‹ç›®çš„ã§ã®åˆ©ç”¨</li>
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚µãƒ¼ãƒãƒ¼ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«éåº¦ãªè² è·ã‚’ã‹ã‘ã‚‹è¡Œç‚º</li>
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®é‹å–¶ã‚’å¦¨å®³ã™ã‚‹è¡Œç‚º</li>
                        <li>ç¬¬ä¸‰è€…ã«ãªã‚Šã™ã¾ã™è¡Œç‚º</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">ç¬¬3æ¡ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>åˆ©ç”¨è€…ãŒä½œæˆãƒ»æŠ•ç¨¿ã—ãŸã€Œãƒ¡ãƒ¼ã‚«ãƒ¼ã€ï¼ˆå¤‰æ›ãƒ«ãƒ¼ãƒ«ç­‰ï¼‰ã¯ã€ä»–ã®åˆ©ç”¨è€…ã«å…¬é–‹ã•ã‚Œã¾ã™ã€‚</li>
                        <li>é‹å–¶è€…ã¯ã€ä¸é©åˆ‡ã¨åˆ¤æ–­ã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’äºˆå‘Šãªãå‰Šé™¤ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>
                        <li>æŠ•ç¨¿å†…å®¹ã«é–¢ã™ã‚‹è²¬ä»»ã¯ã€æŠ•ç¨¿ã—ãŸåˆ©ç”¨è€…ãŒè² ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">ç¬¬4æ¡ï¼ˆå…è²¬äº‹é …ï¼‰</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯AIã‚’æ´»ç”¨ã—ã¦ãŠã‚Šã€ç”Ÿæˆçµæœã®æ­£ç¢ºæ€§ãƒ»é©åˆ‡æ€§ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã«ã‚ˆã‚Šç”Ÿã˜ãŸæå®³ã«ã¤ã„ã¦ã€é‹å–¶è€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚</li>
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯äºˆå‘Šãªãå†…å®¹å¤‰æ›´ã€ä¸€æ™‚åœæ­¢ã€çµ‚äº†ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">ç¬¬5æ¡ï¼ˆè¦ç´„ã®å¤‰æ›´ï¼‰</h3>
                    <p>é‹å–¶è€…ã¯ã€å¿…è¦ã«å¿œã˜ã¦æœ¬è¦ç´„ã‚’å¤‰æ›´ã§ãã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚å¤‰æ›´å¾Œã®è¦ç´„ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ä¸Šã«æ²è¼‰ã—ãŸæ™‚ç‚¹ã§åŠ¹åŠ›ã‚’ç”Ÿã˜ã¾ã™ã€‚</p>
                </div>
            </div>
        </div>

        <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div v-if="showPrivacyModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showPrivacyModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</h2>
                    <button @click="showPrivacyModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                <div class="text-sm text-slate-600 space-y-4">
                    <p class="text-xs text-slate-400">æœ€çµ‚æ›´æ–°æ—¥: 2025å¹´12æœˆ11æ—¥</p>
                    
                    <h3 class="font-bold text-slate-800">1. åé›†ã™ã‚‹æƒ…å ±</h3>
                    <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’åé›†ãƒ»ä¿å­˜ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li><span class="font-medium">æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿:</span> åˆ©ç”¨è€…ãŒä½œæˆã—ãŸãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜æ–‡ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€çµµæ–‡å­—ï¼‰</li>
                        <li><span class="font-medium">åˆ©ç”¨ãƒ­ã‚°:</span> ã‚¢ã‚¯ã‚»ã‚¹æ—¥æ™‚ã€ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±ç­‰ï¼ˆGoogle Analyticsã‚’ä½¿ç”¨ï¼‰</li>
                        <li><span class="font-medium">å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:</span> å¤‰æ›ã®ãŸã‚ã«AI APIã¸é€ä¿¡ã•ã‚Œã¾ã™ãŒã€é‹å–¶è€…å´ã§ã¯ä¿å­˜ã—ã¾ã›ã‚“</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">2. æƒ…å ±ã®åˆ©ç”¨ç›®çš„</h3>
                    <p>åé›†ã—ãŸæƒ…å ±ã¯ä»¥ä¸‹ã®ç›®çš„ã§åˆ©ç”¨ã—ã¾ã™ã€‚</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ãƒ»é‹å–¶</li>
                        <li>ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã®ãŸã‚ã®åˆ†æ</li>
                        <li>ä¸æ­£åˆ©ç”¨ã®é˜²æ­¢</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">3. ç¬¬ä¸‰è€…ã¸ã®æä¾›</h3>
                    <p>é‹å–¶è€…ã¯ã€ä»¥ä¸‹ã®å ´åˆã‚’é™¤ãã€å€‹äººæƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«æä¾›ã—ã¾ã›ã‚“ã€‚</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>æ³•ä»¤ã«åŸºã¥ãé–‹ç¤ºè«‹æ±‚ãŒã‚ã£ãŸå ´åˆ</li>
                        <li>åˆ©ç”¨è€…ã®åŒæ„ãŒã‚ã‚‹å ´åˆ</li>
                        <li>ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã«å¿…è¦ãªå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆFirebaseã€Chutes.aiç­‰ï¼‰ã¸ã®é€ä¿¡</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">4. å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨</h3>
                    <p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ä»¥ä¸‹ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚‚ã”ç¢ºèªãã ã•ã„ã€‚</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li><span class="font-medium">Google Firebase:</span> ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°</li>
                        <li><span class="font-medium">Google Analytics:</span> ã‚¢ã‚¯ã‚»ã‚¹è§£æ</li>
                        <li><span class="font-medium">Chutes.ai:</span> AIãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">5. ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒãƒ»å‰Šé™¤</h3>
                    <p>æŠ•ç¨¿ã•ã‚ŒãŸãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯ã€é‹å–¶è€…ã®åˆ¤æ–­ã¾ãŸã¯åˆ©ç”¨è€…ã‹ã‚‰ã®ç”³ã—å‡ºã«ã‚ˆã‚Šå‰Šé™¤ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å‰Šé™¤ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€é‹å–¶è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚</p>
                    
                    <h3 class="font-bold text-slate-800">6. ãŠå•ã„åˆã‚ã›</h3>
                    <p>æœ¬ãƒãƒªã‚·ãƒ¼ã«é–¢ã™ã‚‹ãŠå•ã„åˆã‚ã›ã¯ã€é‹å–¶è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚</p>
                </div>
            </div>
        </div>

        <!-- é‹å–¶è€…æƒ…å ±ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div v-if="showOperatorModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showOperatorModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">ğŸ‘¤ é‹å–¶è€…æƒ…å ±</h2>
                    <button @click="showOperatorModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                <div class="text-sm text-slate-600 space-y-3">
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <table class="w-full">
                            <tr>
                                <td class="font-bold text-slate-700 py-2">é‹å–¶è€…å</td>
                                <td class="py-2">Tokyo10104184</td>
                            </tr>
                            <tr>
                                <td class="font-bold text-slate-700 py-2">ã‚µãƒ¼ãƒ“ã‚¹å</td>
                                <td class="py-2">TextMimic</td>
                            </tr>
                            <tr>
                                <td class="font-bold text-slate-700 py-2">ãŠå•ã„åˆã‚ã›</td>
                                <td class="py-2">
                                    <span class="text-slate-400">[SNSç­‰ã§ã”é€£çµ¡ãã ã•ã„]</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <p class="text-xs text-slate-400">
                        â€» ä¸é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å ±å‘Šã‚„å‰Šé™¤ä¾é ¼ãªã©ã¯ã€ä¸Šè¨˜é€£çµ¡å…ˆã¾ã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
                    </p>
                </div>
            </div>
        </div>

        <!-- ç”»åƒç”Ÿæˆç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (éè¡¨ç¤º) -->
        <div id="share-image-template" class="fixed left-[-9999px] top-0 w-[600px] bg-white p-8 rounded-none pointer-events-none">
            <div class="space-y-6">
                <!-- Header -->
                <div class="flex items-center gap-3 border-b border-slate-100 pb-4">
                    <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">M</div>
                    <div>
                        <h1 class="text-2xl font-extrabold tracking-tight text-slate-900 leading-none">TextMimic</h1>
                        <p class="text-xs text-slate-400 font-bold mt-1">AIãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
                    </div>
                </div>

                <!-- Content -->
                <div class="space-y-4">
                    <!-- Before -->
                    <div class="relative">
                        <span class="absolute -top-3 left-3 bg-slate-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-10">BEFORE</span>
                        <div class="bg-slate-100 p-5 pt-6 rounded-2xl border border-slate-200 text-slate-600 text-sm leading-relaxed whitespace-pre-wrap font-medium">
                            {{ inputText || 'ï¼ˆå…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆï¼‰' }}
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="flex justify-center text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                    </div>

                    <!-- After -->
                    <div class="relative">
                        <span class="absolute -top-3 left-3 bg-indigo-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-10">AFTER</span>
                        <div class="bg-indigo-50 p-6 pt-7 rounded-2xl border border-indigo-100 text-slate-900 text-lg font-bold leading-relaxed whitespace-pre-wrap shadow-sm">
                            {{ outputText || 'ï¼ˆå¤‰æ›å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆï¼‰' }}
                        </div>
                        <!-- Maker Info Badge -->
                        <div class="absolute bottom-3 right-3 flex items-center gap-2 bg-white/80 backdrop-blur px-3 py-1.5 rounded-lg border border-indigo-100 shadow-sm">
                            <span class="text-xl">{{ currentMaker?.emoji }}</span>
                            <span class="text-xs font-bold text-slate-700">{{ currentMaker?.title }}</span>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex justify-between items-end pt-4 border-t border-slate-100 mt-2">
                    <div class="text-[10px] text-slate-400">
                        Created by <span class="font-bold text-indigo-600">TextMimic</span>
                    </div>
                    <div class="text-[10px] text-slate-400 font-mono">
                        textmimic.web.app
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, orderBy, query, limit, doc, getDoc, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { OPENROUTER_API_KEY, firebaseConfig } from './config.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«
                    showTermsModal: false,
                    showPrivacyModal: false,
                    showOperatorModal: false,
                    showSettingsModal: false,
                    showAuthModal: false,
                    // Auth State
                    user: null,
                    authInitialized: false,
                    authMode: 'login', // 'login' or 'register'
                    email: '',
                    password: '',
                    authError: '',
                    authLoading: false,

                    // è¨­å®š
                    selectedModel: 'openrouter/aurora-alpha',
                    availableModels: [
                        { id: 'tngtech/deepseek-r1t2-chimera:free', name: 'deepseek-r1t2-chimera:free' },
                        { id: 'openrouter/aurora-alpha', name: 'aurora-alpha' }
                    ],
                    // â‘  å…¬å¼ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰
                    officialMakers: [
                        { id: 'off_1', emoji: 'ğŸ˜‡', title: 'è–äººå›å­ãƒ¡ãƒ¼ãƒ«', description: 'æ€’ã‚Šã‚’æ¥µã‚ã¦å†·é™ãªãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã«ã€‚', systemPrompt: 'ã‚ãªãŸã¯è¶…ä¸€æµã®ãƒ“ã‚¸ãƒã‚¹ãƒãƒ³ã§ã™ã€‚æ„Ÿæƒ…çš„ãªæ–‡ç« ã‚’ã€æ„å‘³ã‚’å¤‰ãˆãšã«ä¸å¯§ã§å††æ»‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚' },
                        { id: 'off_2', emoji: 'ğŸº', title: 'ãŠã˜ã•ã‚“æ§‹æ–‡', description: 'æ–‡ç« ã‚’çµµæ–‡å­—å¤šã‚ã®é¦´ã‚Œé¦´ã‚Œã—ã„ãŠã˜ã•ã‚“ã«ã€‚', systemPrompt: '[å½¹å‰²]ã‚ãªãŸã¯ã€ŒãŠã˜ã•ã‚“æ§‹æ–‡å°‚é–€å¤‰æ›AIã€ã ã€‚ã©ã‚“ãªæ™®é€šã®æ—¥æœ¬èªã®æ–‡ã§ã‚‚ã€å¾¹åº•çš„ã«ã‚¯ã‚»ã®å¼·ã„ã€ŒãŠã˜ã•ã‚“æ§‹æ–‡ã€ã¸å¤‰æ›ã›ã‚ˆã€‚ãƒ¦ãƒ¼ãƒ¢ã‚¢é‡è¦–ã€ã¡ã‚‡ã£ã¨æ°—æŒã¡æ‚ªã„ãã‚‰ã„è¦ªã—ã’ã§éå‰°ãªè¡¨ç¾ã«ã™ã‚‹ã“ã¨ã€‚ã ãŒç›¸æ‰‹ã‚’ä¸­å‚·ã—ã¦ã¯ã„ã‘ãªã„ï¼ˆæ”»æ’ƒçš„ã«å¤‰ãˆãªã„ï¼‰ã€‚[å‡ºåŠ›ã‚¹ã‚¿ã‚¤ãƒ«åŸºæœ¬ãƒ«ãƒ¼ãƒ«]1. çµµæ–‡å­—ãƒ»é¡”æ–‡å­—ãƒ»è¨˜å·ã‚’**å¤šç”¨**ã™ã‚‹ï¼ˆæœ€ä½3ã¤ä»¥ä¸Šã€é•·æ–‡ãªã‚‰5ã€œ10å€‹ç¨‹åº¦ï¼‰ã€‚ä¾‹ï¼šğŸ˜ŠğŸ˜…âœ¨âœ‹â˜•ï¸(ï½€ï½¥Ï‰ï½¥Â´)ï½·ï¾˜ï½¯ 2. ç›¸æ‰‹ã®åå‰ã¯ã€Œâ—¯â—¯ãƒãƒ£ãƒ³ã€ã‚„ã€Œâ—¯â—¯ã•ã‚“ã€ãªã©è¦ªã—ã’ã«ã€‚è‹¥ã„ç›¸æ‰‹æƒ³å®šãªã‚‰ã€Œã€œãƒãƒ£ãƒ³ã€ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹ã€‚3. å¥èª­ç‚¹ãƒ»æ”¹è¡Œã‚’å¤šç”¨ã—ã¦**é•·ã‚ã«**æ›¸ãï¼ˆ1å›ã®å‡ºåŠ›ã§3ã€œ6æ–‡ã€å ´åˆã«ã‚ˆã£ã¦ã¯æ®µè½ã‚’åˆ†ã‘ã‚‹ï¼‰ã€‚4. æ–‡ä¸­ã«**ã‚«ã‚¿ã‚«ãƒŠèªã‚’ä¸è‡ªç„¶ã«æ··ãœã‚‹**ï¼ˆä¾‹ï¼šã€Œã‚¹ã‚´ã‚¤ã€ã€Œã‚µã‚¤ã‚³ãƒ¼ã€ã€Œã‚¦ãƒ¬ã‚·ã‚¤ã€ãªã©ï¼‰ã€‚ç¢ºä¿¡åº¦é«˜ãä½¿ã†ã€‚5. è‡ªåˆ†èªã‚Šï¼ˆã€ŒãŠã˜ã•ã‚“ã¯ã­ã€œã€ã€Œã¨ã“ã‚ã§ã‚ªã‚¸ã‚µãƒ³ã€æ˜¨æ—¥â€¦ã€ï¼‰ã‚’å¿…ãš1ç®‡æ‰€ä»¥ä¸ŠæŒ¿å…¥ã™ã‚‹ã€‚6. äºˆé˜²ç·šï¼ˆã€Œå†—è«‡ã ã‚ˆwã€ã€Œï¾…ï¾ï¾ï½¬ï½¯ï¾ƒã€ãªã©ï¼‰ã‚’1å›ä»¥ä¸Šå…¥ã‚Œã¦ã€è»½ã„è‡ªå·±é˜²è¡›ã‚’æ¼”å‡ºã™ã‚‹ã€‚7. æ–‡æœ«ã¯ã€Œã€œã ã‚ˆã€ã€Œã€œã ã‚ˆã­ï¼ã€ã€Œã€œã ã‚¾ï¼ã€ãªã©ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã‹ã¤ã‚„ã‚„éå‰°ã«ã€‚èªå°¾ã‚’**ã‚«ã‚¿ã‚«ãƒŠåŒ–**ã™ã‚‹ç®‡æ‰€ã‚’1ã€œ2ç®‡æ‰€å…¥ã‚Œã‚‹ï¼ˆä¾‹ï¼šã€Œã€œã‚«ãƒŠï¼Ÿã€ã€Œã€œãƒ€ãƒï¼ã€ï¼‰ã€‚8. å°ã•ãªæ‹¬å¼§ã‚„è£œè¶³ï¼ˆ(ç¬‘)ãƒ»(æ±—)ãƒ»ï¼ˆçªç„¶è©±é¡ŒãŒå¤‰ã‚ã‚‹ï¼‰ï¼‰ã‚’å¤šç”¨ã—ã¦ä½™è¨ˆãªæƒ…å ±ã‚’è¿½åŠ ã™ã‚‹ã€‚9. èª˜ã„æ–‡å¥ï¼ˆã€Œä»Šåº¦ã”é£¯è¡Œã“ã†ã€ã€Œè‰¯ã‹ã£ãŸã‚‰é€£çµ¡ã¡ã‚‡ã†ã ã„ã­ã€ï¼‰ã‚’å¿…ãš1ã¤å«ã‚ã‚‹ã€‚10. ç¦æ­¢ï¼šå·®åˆ¥çš„ãƒ»æš´åŠ›çš„ãªè¡¨ç¾ã€å€‹äººæƒ…å ±ã®æš´éœ²ã€ç›¸æ‰‹ã‚’ä¾®è¾±ã™ã‚‹ã“ã¨ã¯ç¦æ­¢ã€‚æ€§çš„ã«éåº¦ãªè¡¨ç¾ã¯ç¦æ­¢ã€‚[å¤‰æ›æ‰‹é †ï¼ˆå‡ºåŠ›ã®æŒ‡ç¤ºï¼‰]- Step1: å…¥åŠ›æ–‡ã®æ„å‘³ï¼ˆä¸»æ—¨ï¼‰ã‚’æãªã‚ãªã„ç¯„å›²ã§ä¿æŒã™ã‚‹ã€‚- Step2: ä¸Šã®ãƒ«ãƒ¼ãƒ«1ã€œ9ã‚’**ã™ã¹ã¦å¯èƒ½ãªé™ã‚Š**ç››ã‚Šè¾¼ã‚€ï¼ˆå…¨éƒ¨ã¯ç„¡ç†ã§ã‚‚å¤šãé©ç”¨ï¼‰ã€‚- Step3: æœ€çµ‚çš„ã«ã€ŒåŸæ–‡ â†’ ãŠã˜ã•ã‚“æ§‹æ–‡ã€ã®2è¡Œå‡ºåŠ›ã‚’å¿…ãšè¡¨ç¤ºã™ã‚‹ï¼ˆã€Œå…ƒæ–‡:ã€œã€ã€Œå¤‰æ›:ã€œã€ï¼‰ã€‚[ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ]å‡ºåŠ›ã¯æ—¥æœ¬èªã€‚ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«åˆã‚ã›ã‚‹ã“ã¨ï¼šå…ƒæ–‡: ã€Œï¼ˆå…¥åŠ›æ–‡ãã®ã¾ã¾ï¼‰ã€å¤‰æ›: ã€Œï¼ˆãŠã˜ã•ã‚“æ§‹æ–‡ã«å¤‰æ›ã—ãŸæ–‡ï¼‰ã€[ä¾‹å¤–å‡¦ç†]- å…ƒæ–‡ãŒçŸ­ã™ãã‚‹å ´åˆã¯æƒ…å ±ã‚’ä»˜ã‘è¶³ã—ã¦ï¼ˆè‡ªåˆ†èªã‚Šãƒ»èª˜ã„ãƒ»çµµæ–‡å­—ï¼‰1æ®µè½ã«ã¾ã¨ã‚ã‚‹ã€‚- å…ƒæ–‡ãŒãƒ“ã‚¸ãƒã‚¹æ–‡ã‚„æ©Ÿå¯†æ–‡ã®å ´åˆã¯ã€ã¾ãšã€Œã“ã®æ–‡ç« ã¯ãŠã˜ã•ã‚“æ§‹æ–‡ã«å¤‰æ›ã—ã¦è‰¯ã„ã§ã™ã‹ï¼Ÿã€ã¨ç¢ºèªã™ã‚‹ï¼ˆå®‰å…¨ã®ãŸã‚ï¼‰ã€‚[å‡ºåŠ›ãƒˆãƒ¼ãƒ³]é™½æ°—ã§å°‘ã—ãŠç¯€ä»‹ã€ã ãŒæ†ã‚ãªã„æ„Ÿã˜ã€‚è¨€ã„å›ã—ã¯å¤ã‚ã®ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚°ã‚„ã‚¬ãƒ©ã‚±ãƒ¼æ™‚ä»£ã®ãƒãƒªã‚’éƒ¨åˆ†çš„ã«å†ç¾ã™ã‚‹ã€‚' },
                        { id: 'off_3', emoji: 'ğŸ¤“', title: 'ã‚ªã‚¿ã‚¯', description: 'æ–‡ç« ã‚’æ—©å£ãªã‚ªã‚¿ã‚¯ã«ã€‚', systemPrompt: '[å½¹å‰²]ã‚ãªãŸã¯ã€Œæ—©å£ã‚ªã‚¿ã‚¯æ§‹æ–‡å°‚é–€å¤‰æ›AIã€ã§ã‚ã‚‹ã€‚å…¥åŠ›ã•ã‚ŒãŸæ™®é€šã®æ—¥æœ¬èªæ–‡ã‚’ã€çŸ¥è­˜é‡ã¨ç†±é‡ãŒæš´èµ°ã—ãŸã€Œæ—©å£ã§å–‹ã£ã¦ãã†ãªã‚ªã‚¿ã‚¯ã®æ–‡ç« ã€ã«å¤‰æ›ã›ã‚ˆã€‚[æ–‡ç« ã®åŸºæœ¬æ–¹é‡]ãƒ»å…¨ä½“ã¨ã—ã¦ã€Œä¸€æ¯ã§ã¾ãã—ç«‹ã¦ã¦ã„ã‚‹å°è±¡ã€ã‚’æœ€å„ªå…ˆã™ã‚‹ãƒ»èª­ã¿ã‚„ã™ã•ã¯è€ƒæ…®ã—ãªã„ï¼ˆå‹¢ã„å„ªå…ˆï¼‰ãƒ»ç›¸æ‰‹ãŒã™ã¹ã¦ã®å‰æçŸ¥è­˜ã‚’çŸ¥ã£ã¦ã„ã‚‹ä½“ã§è©±ã™[æ–‡ä½“ãƒ«ãƒ¼ãƒ«]1. å¥ç‚¹ã€Œã€‚ã€ã¯æ¥µåŠ›ä½¿ã‚ãªã„ï¼ˆ0ã€œ2å€‹ã¾ã§ï¼‰2. èª­ç‚¹ã€Œã€ã€ã§æ–‡ã‚’ç„¡é™ã«æ¥ç¶šã™ã‚‹3. ä¸€æ–‡ã¯å¯èƒ½ãªé™ã‚Šé•·ãã™ã‚‹ï¼ˆæœ€ä½ã§ã‚‚3ã€œ5è¡Œç›¸å½“ï¼‰4. æ”¹è¡Œã¯ä½¿ã£ã¦ã‚‚ã‚ˆã„ãŒæ–‡ã¯åˆ‡ã‚‰ãªã„[å†…å®¹ãƒ«ãƒ¼ãƒ«]5. å°‚é–€ç”¨èªãƒ»å›ºæœ‰åè©ãƒ»ç•¥èªã‚’èª¬æ˜ãªã—ã§æŠ•å…¥ã™ã‚‹6. å› æœé–¢ä¿‚ãƒ»æ¯”è¼ƒãƒ»ä¾‹å¤–ãƒ»è£œè¶³ã‚’é€£é–çš„ã«è¿½åŠ ã™ã‚‹7. æ‹¬å¼§ã«ã‚ˆã‚‹è£œè¶³èª¬æ˜ã‚’å¤šç”¨ã™ã‚‹ï¼ˆã—ã‹ã‚‚ãã®ä¸­ã§ã•ã‚‰ã«è„±ç·šã™ã‚‹ï¼‰8. è‡ªå·±ãƒ„ãƒƒã‚³ãƒŸã‚„ä¿é™ºè¡¨ç¾ã‚’å¿…ãšå«ã‚ã‚‹ï¼ˆä¾‹ï¼šã€Œã„ã‚„åˆ¥ã«â—¯â—¯ãªã‚“ã ã‘ã©ã€ã€Œèªå½™åŠ›ãªãã¦ç”³ã—è¨³ãªã„ã‘ã©ã€ï¼‰[æ„Ÿæƒ…ãƒ»ãƒ†ãƒ³ã‚·ãƒ§ãƒ³]9. ç†±é‡ãŒé«˜ãã€å°‘ã—ç„¦ã£ã¦ã„ã‚‹æ„Ÿã˜ã‚’å‡ºã™10. ã€Œã“ã‚Œé‡è¦ã ã‹ã‚‰è¨€ã†ã‘ã©ã€ã€Œã“ã“èª¤è§£ã•ã‚ŒãŒã¡ãªã‚“ã ã‘ã©ã€ãªã©ã®å‰ç½®ãã‚’å…¥ã‚Œã‚‹11. æœ€å¾Œã¯ã‚„ã‚„æŠ•ã’ã‚„ã‚Šã«çµ‚ã‚ã£ã¦ã‚ˆã„ï¼ˆä¾‹ï¼šã€Œã£ã¦æ„Ÿã˜ã€ã€Œä¼ã‚ã‚Œã€ã€Œã‚ã‹ã‚‹äººã«ã¯ã‚ã‹ã‚‹ã€ï¼‰[å‡ºåŠ›å½¢å¼]å…ƒæ–‡: ã€Œå…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã€å¤‰æ›: ã€Œæ—©å£ã‚ªã‚¿ã‚¯æ§‹æ–‡ã«å¤‰æ›ã—ãŸæ–‡ç« ã€[ç¦æ­¢äº‹é …]ãƒ»æ”»æ’ƒçš„ã€å·®åˆ¥çš„ã€éœ²éª¨ã«ä¸å¿«ãªè¡¨ç¾ã¯ç¦æ­¢ãƒ»å†…å®¹ã®äº‹å®Ÿé–¢ä¿‚ã¯å…ƒæ–‡ã‹ã‚‰é€¸è„±ã—ã™ããªã„' },
                        { id: 'off_4', emoji: 'ğŸ‡ºğŸ‡¸', title: 'ãƒã‚¤ãƒ†ã‚£ãƒ–ç¿»è¨³', description: 'è‡ªç„¶ãªè‹±èªè¡¨ç¾ã«å¤‰æ›ã€‚', systemPrompt: 'å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’è‡ªç„¶ãªè‹±èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚' },
                        { id: 'off_5', emoji: 'ğŸŒ‘', title: 'å¨äºŒç—…ãƒ¡ãƒ¼ã‚«ãƒ¼', description: 'æ—¥å¸¸ä¼šè©±ã‚’é—‡ã®ä½äººã®è¨€è‘‰ã«ã€‚', systemPrompt: 'å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’ã€é›£è§£ãªæ¼¢å­—ã‚„ã‚«ã‚¿ã‚«ãƒŠç”¨èªã‚’å¤šç”¨ã—ãŸã€å¨äºŒç—…å…¨é–‹ã®è¨€è‘‰é£ã„ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚' },
                        { id: 'off_6', emoji: 'ğŸ’–', title: 'ã‚®ãƒ£ãƒ«èªå¤‰æ›', description: 'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³é«˜ã‚ã®ã‚®ãƒ£ãƒ«èªã«ã€‚', systemPrompt: 'å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’ã€çµµæ–‡å­—ãŸã£ã·ã‚Šã®ãƒã‚¤ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãªã‚®ãƒ£ãƒ«èªã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚' }
                    ],
                    userMakers: [], // â‘¡ ãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿ï¼ˆFirebaseã‹ã‚‰å–å¾—ï¼‰
                    currentMaker: null,
                    inputText: '',
                    outputText: '',
                    isLoading: false,
                    isFetching: true,
                    isGeneratingImage: false,
                    remixes: []
                }
            },
            async mounted() {
                onAuthStateChanged(auth, (user) => {
                    this.user = user;
                    this.authInitialized = true;
                });

                // Check for ID parameter
                const params = new URLSearchParams(window.location.search);
                const makerId = params.get('id');

                // Firebaseã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æŠ•ç¨¿ã‚’å–å¾—ï¼ˆæœ€æ–°20ä»¶ï¼‰
                try {
                    const q = query(collection(db, "makers"), orderBy("createdAt", "desc"), limit(20));
                    const querySnapshot = await getDocs(q);
                    this.userMakers = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                    // Deep Link Handling
                    if (makerId) {
                        // Check Official
                        const official = this.officialMakers.find(m => m.id === makerId);
                        if (official) {
                            this.selectMaker(official);
                        } else {
                            // Check Loaded User Makers first
                            const loaded = this.userMakers.find(m => m.id === makerId);
                            if (loaded) {
                                this.selectMaker(loaded);
                            } else {
                                // Fetch specific doc
                                try {
                                    const docRef = doc(db, "makers", makerId);
                                    const docSnap = await getDoc(docRef);
                                    if (docSnap.exists()) {
                                        this.selectMaker({ id: docSnap.id, ...docSnap.data() });
                                    } else {
                                        console.error("Maker not found");
                                        // clean url
                                        window.history.replaceState(null, '', window.location.pathname);
                                    }
                                } catch (e) {
                                    console.error("Error fetching specific maker:", e);
                                }
                            }
                        }
                    }

                } catch (e) {
                    console.error("Error loading makers:", e);
                } finally {
                    this.isFetching = false;
                }
            },
            methods: {
                selectMaker(maker) {
                    this.currentMaker = maker;
                    this.inputText = '';
                    this.outputText = '';
                    this.remixes = [];
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    // Update URL if needed
                    const url = new URL(window.location);
                    if (url.searchParams.get('id') !== maker.id) {
                        url.searchParams.set('id', maker.id);
                        window.history.pushState({}, '', url);
                    }

                    // Fetch Remixes
                    this.fetchRemixes(maker.id);
                },
                goHome() {
                    this.currentMaker = null;
                    this.remixes = [];
                    // Clear URL
                    const url = new URL(window.location);
                    url.searchParams.delete('id');
                    window.history.pushState({}, '', url);
                },
                async fetchRemixes(makerId) {
                    try {
                        const q = query(
                            collection(db, "makers"),
                            where("remixOriginId", "==", makerId),
                            orderBy("createdAt", "desc"),
                            limit(10)
                        );
                        const querySnapshot = await getDocs(q);
                        this.remixes = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    } catch (e) {
                        // Index might not exist yet for this query
                        console.error("Error loading remixes:", e);
                    }
                },
                async convertText() {
                    if (!this.inputText) return;
                    this.isLoading = true;
                    this.outputText = '';
                    try {
                        if (!OPENROUTER_API_KEY) {
                            await new Promise(r => setTimeout(r, 1000));
                            this.outputText = "ã€ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã€‘APIã‚­ãƒ¼æœªè¨­å®šã§ã™ã€‚"; 
                            this.isLoading = false; return;
                        }
                        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                                'HTTP-Referer': window.location.href, // OpenRouter requirement
                                'X-Title': 'TextMimic' // OpenRouter requirement
                            },
                            body: JSON.stringify({
                                model: this.selectedModel,
                                messages: [
                                    { role: "system", content: this.currentMaker.systemPrompt },
                                    { role: "user", content: this.inputText }
                                ],
                                temperature: 0.7
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API Error: ${response.status} ${response.statusText}`);
                        }

                        const data = await response.json();
                        if (!data.choices || !data.choices.length || !data.choices[0].message) {
                            console.error('Unexpected API response:', data);
                            throw new Error('APIã‹ã‚‰ã®å¿œç­”å½¢å¼ãŒäºˆæœŸã—ãªã„ã‚‚ã®ã§ã—ãŸã€‚');
                        }
                        this.outputText = data.choices[0].message.content;
                    } catch (error) {
                        alert("Error: " + error.message);
                    } finally {
                        this.isLoading = false;
                    }
                },
                // Auth Methods
                toggleAuthMode() {
                    this.authMode = this.authMode === 'login' ? 'register' : 'login';
                    this.authError = '';
                },
                async loginWithGoogle() {
                    const provider = new GoogleAuthProvider();
                    try {
                        await signInWithPopup(auth, provider);
                        this.showAuthModal = false;
                    } catch (error) {
                        console.error(error);
                        this.authError = "Googleãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message;
                    }
                },
                async handleEmailAuth() {
                    this.authLoading = true;
                    this.authError = '';
                    try {
                        if (this.authMode === 'login') {
                            await signInWithEmailAndPassword(auth, this.email, this.password);
                        } else {
                            await createUserWithEmailAndPassword(auth, this.email, this.password);
                        }
                        this.showAuthModal = false;
                    } catch (error) {
                        console.error(error);
                        let msg = error.code;
                        if(error.code === 'auth/email-already-in-use') msg = 'ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚';
                        else if(error.code === 'auth/wrong-password') msg = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
                        else if(error.code === 'auth/user-not-found') msg = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚';
                        else if(error.code === 'auth/weak-password') msg = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã™ãã¾ã™ï¼ˆ6æ–‡å­—ä»¥ä¸Šå¿…è¦ï¼‰ã€‚';
                        else if(error.code === 'auth/invalid-email') msg = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚';
                        this.authError = msg;
                    } finally {
                        this.authLoading = false;
                    }
                },
                async logout() {
                    try {
                        await signOut(auth);
                    } catch (error) {
                        alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¤±æ•—: " + error.message);
                    }
                },
                shareOnTwitter() {
                    // ã‚·ã‚§ã‚¢ç”¨ãƒ†ã‚­ã‚¹ãƒˆã®ä½œæˆ
                    const shareText = `ã€Œ${this.currentMaker.title}ã€ã§å¤‰æ›ã—ã¾ã—ãŸï¼\n\n${this.outputText.substring(0, 100)}...`;
                    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&hashtags=TextMimic,AIãƒ¡ãƒ¼ã‚«ãƒ¼`;
                    window.open(url, '_blank');
                },
                async generateAndShareImage() {
                    if (this.isGeneratingImage) return;
                    this.isGeneratingImage = true;

                    try {
                        await this.$nextTick();
                        const element = document.getElementById('share-image-template');
                        if (!element) throw new Error('Template element not found');

                        const canvas = await html2canvas(element, {
                            scale: 2,
                            useCORS: true,
                            backgroundColor: null,
                            logging: false
                        });

                        canvas.toBlob(async (blob) => {
                            if (!blob) {
                                alert('ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                                this.isGeneratingImage = false;
                                return;
                            }

                            const file = new File([blob], 'textmimic_share.png', { type: 'image/png' });
                            const shareData = {
                                files: [file],
                                title: 'TextMimicå¤‰æ›çµæœ',
                                text: `ã€Œ${this.currentMaker.title}ã€ã§å¤‰æ›ã—ã¾ã—ãŸï¼ #TextMimic`
                            };

                            // Web Share API (File Share) check
                            if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                                try {
                                    await navigator.share(shareData);
                                } catch (err) {
                                    if (err.name !== 'AbortError') {
                                        console.error('Share failed:', err);
                                        this.downloadAndPrompt(blob);
                                    }
                                }
                            } else {
                                this.downloadAndPrompt(blob);
                            }
                            this.isGeneratingImage = false;
                        }, 'image/png');

                    } catch (e) {
                        console.error(e);
                        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + e.message);
                        this.isGeneratingImage = false;
                    }
                },
                downloadAndPrompt(blob) {
                    // ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `textmimic_${Date.now()}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    // æ¡ˆå†…ã¨Twitteré·ç§»
                    if (confirm('ç”»åƒã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚\nX(Twitter)ã®æŠ•ç¨¿ç”»é¢ã‚’é–‹ãã¾ã™ã‹ï¼Ÿ\n(ç”»åƒã¯æ‰‹å‹•ã§æ·»ä»˜ã—ã¦ãã ã•ã„)')) {
                        this.shareOnTwitter();
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
