<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextMimic - AI„ÉÜ„Ç≠„Çπ„ÉàÂ§âÊèõ„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; }
        [v-cloak] { display: none !important; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .loader { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-flex; animation: marquee 40s linear infinite; }
        .marquee-content:hover { animation-play-state: paused; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
    <div id="app" v-cloak class="max-w-5xl mx-auto min-h-screen flex flex-col">
        <!-- „Éä„Éì -->
        <nav class="flex items-center justify-between p-4 md:p-6">
            <div class="flex items-center gap-2 cursor-pointer" @click="goHome">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">M</div>
                <span class="text-lg md:text-xl font-extrabold tracking-tight text-slate-900">TextMimic</span>
            </div>
            <div class="flex items-center gap-4">
                <button @click="showSettingsModal = true" class="text-slate-500 hover:text-slate-800 transition p-2 rounded-lg hover:bg-slate-100" title="Ë®≠ÂÆö">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </button>

                <!-- Auth Button -->
                <div v-if="!user">
                    <button @click="showAuthModal = true" class="text-sm font-bold text-slate-600 hover:text-slate-900 bg-white border border-slate-200 px-4 py-2 rounded-lg transition hover:bg-slate-50">
                        „É≠„Ç∞„Ç§„É≥
                    </button>
                </div>
                <div v-else class="relative">
                    <button @click="showUserMenu = !showUserMenu" class="flex items-center gap-2 hover:bg-slate-100 p-1.5 pr-3 rounded-full transition group">
                        <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden border border-slate-200 group-hover:border-indigo-300 transition">
                            <img v-if="user.photoURL" :src="user.photoURL" class="w-full h-full object-cover">
                            <div v-else class="w-full h-full flex items-center justify-center text-slate-500 font-bold text-xs">{{ user.email?.charAt(0).toUpperCase() }}</div>
                        </div>
                        <div class="hidden md:block text-xs font-bold text-right text-slate-500 group-hover:text-slate-800">
                            {{ user.displayName || user.email }}
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400 group-hover:text-slate-600"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>

                    <!-- Dropdown Menu -->
                    <div v-if="showUserMenu" class="absolute top-12 right-0 bg-white rounded-xl shadow-xl border border-slate-100 w-48 py-2 z-50 animate-fade-in">
                        <button @click="goToMyMakers(); showUserMenu = false" class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 font-bold flex items-center gap-2">
                            <span>üìù</span> Ëá™ÂàÜ„ÅÆÊäïÁ®ø‰∏ÄË¶ß
                        </button>
                        <div class="border-t border-slate-100 my-1"></div>
                        <button @click="logout" class="w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 font-bold flex items-center gap-2">
                            <span>üö™</span> „É≠„Ç∞„Ç¢„Ç¶„Éà
                        </button>
                    </div>

                    <!-- Overlay to close menu -->
                    <div v-if="showUserMenu" @click="showUserMenu = false" class="fixed inset-0 z-40 bg-transparent cursor-default"></div>
                </div>

                <a href="creator.html" class="bg-slate-900 text-white text-sm font-bold px-4 py-2 rounded-lg hover:bg-slate-800 transition">
                    + ‰Ωú„Çã
                </a>
            </div>
        </nav>

        <main class="flex-1 p-4 md:p-6">
            <transition name="fade" mode="out-in">
                <!-- HOMEÁîªÈù¢ -->
                <div v-if="viewMode === 'home'" key="home">
                    <div class="text-center py-8 md:py-12">
                        <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4 leading-tight">
                            Ë®ÄËëâ„ÇíÈÅä„Åº„ÅÜ„ÄÇ<br><span class="text-indigo-600">AI„ÉÜ„Ç≠„Çπ„ÉàÂ§âÊèõ</span>
                        </h1>
                    </div>

                    <!-- Timeline Section (News Ticker) -->
                    <div v-if="globalSharedResults.length > 0" class="mb-8 -mx-4 md:mx-0 bg-white md:rounded-xl border-y md:border border-slate-200 overflow-hidden relative flex items-center h-10 shadow-sm">
                         <div class="marquee-container w-full">
                            <div class="marquee-content items-center gap-8 px-4">
                                <!-- Original List -->
                                <div
                                    v-for="result in globalSharedResults"
                                    :key="'a-'+result.id"
                                    class="flex items-center gap-2 text-xs font-medium text-slate-600 cursor-pointer hover:text-indigo-600 transition whitespace-nowrap"
                                    @click="goToMakerFromSharedResult(result)"
                                >
                                    <span class="text-base">{{ result.makerEmoji }}</span>
                                    <span class="font-bold text-slate-900">{{ result.makerTitle }}</span>
                                    <span class="text-slate-400 hidden sm:inline">by {{ result.authorName }}</span>
                                    <span class="bg-slate-100 px-2 py-0.5 rounded text-slate-500 max-w-[150px] md:max-w-[200px] truncate">
                                        {{ result.outputText }}
                                    </span>
                                </div>
                                <!-- Duplicate List for Loop -->
                                <div
                                    v-for="result in globalSharedResults"
                                    :key="'b-'+result.id"
                                    class="flex items-center gap-2 text-xs font-medium text-slate-600 cursor-pointer hover:text-indigo-600 transition whitespace-nowrap"
                                    @click="goToMakerFromSharedResult(result)"
                                >
                                    <span class="text-base">{{ result.makerEmoji }}</span>
                                    <span class="font-bold text-slate-900">{{ result.makerTitle }}</span>
                                    <span class="text-slate-400 hidden sm:inline">by {{ result.authorName }}</span>
                                    <span class="bg-slate-100 px-2 py-0.5 rounded text-slate-500 max-w-[150px] md:max-w-[200px] truncate">
                                        {{ result.outputText }}
                                    </span>
                                </div>
                            </div>
                         </div>
                         <!-- Fade Gradients -->
                         <div class="absolute inset-y-0 left-0 w-8 bg-gradient-to-r from-white to-transparent pointer-events-none"></div>
                         <div class="absolute inset-y-0 right-0 w-8 bg-gradient-to-l from-white to-transparent pointer-events-none"></div>
                    </div>

                    <!-- Search & Filter -->
                    <div class="mb-6 md:mb-10 max-w-3xl mx-auto space-y-3 md:space-y-4">
                        <div class="relative">
                            <input v-model="searchQuery" type="text" class="w-full p-3 pl-10 md:p-4 md:pl-12 rounded-2xl border border-slate-200 shadow-sm focus:ring-2 focus:ring-indigo-500 outline-none text-base md:text-lg" placeholder="„É°„Éº„Ç´„Éº„ÇíÊ§úÁ¥¢...">
                            <svg class="absolute left-3 md:left-4 top-1/2 -translate-y-1/2 text-slate-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </div>

                        <!-- Categories -->
                        <div class="flex overflow-x-auto gap-2 px-4 -mx-4 pb-2 md:flex-wrap md:justify-center md:px-0 md:mx-0 md:pb-0 scrollbar-hide">
                            <button
                                @click="selectCategory(null)"
                                :class="['flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition whitespace-nowrap', !selectedCategory && !searchTag ? 'bg-slate-900 text-white' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50']"
                            >„Åô„Åπ„Å¶</button>
                            <button
                                v-for="cat in categories"
                                :key="cat.id"
                                @click="selectCategory(cat.id)"
                                :class="['flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition whitespace-nowrap', selectedCategory === cat.id ? 'bg-indigo-600 text-white' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50']"
                            >
                                {{ cat.label }}
                            </button>
                        </div>

                        <!-- Active Filters Message -->
                        <div v-if="searchTag" class="flex items-center justify-center gap-2">
                            <span class="text-sm font-bold text-slate-600">„Çø„Ç∞: #{{ searchTag }}</span>
                            <button @click="clearFilters" class="text-xs text-red-500 hover:underline">„ÇØ„É™„Ç¢</button>
                        </div>
                    </div>

                    <!-- ‚ë† ÂÖ¨Âºè„Éî„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó -->
                    <section v-if="showOfficialSection" class="mb-12">
                        <h2 class="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <span>üëë</span> ÂÖ¨Âºè„Éî„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                        </h2>
                        <div class="flex overflow-x-auto gap-4 px-4 -mx-4 pb-4 md:grid md:grid-cols-2 lg:grid-cols-3 md:gap-6 md:px-0 md:mx-0 md:pb-0 scrollbar-hide snap-x">
                            <div 
                                v-for="maker in officialMakers" 
                                :key="maker.id"
                                @click="selectMaker(maker)"
                                class="flex-shrink-0 w-80 md:w-auto snap-center relative overflow-hidden bg-white p-5 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer group h-full flex flex-col"
                            >
                                <!-- Watermark Emoji -->
                                <div class="absolute -bottom-6 -right-6 text-9xl opacity-5 pointer-events-none group-hover:scale-110 transition-transform duration-500 rotate-12 select-none">
                                    {{ maker.emoji }}
                                </div>

                                <!-- Header -->
                                <div class="flex items-start justify-between mb-3 relative z-10">
                                    <span class="text-4xl shadow-sm rounded-lg p-1 bg-slate-50/50 backdrop-blur-sm">{{ maker.emoji }}</span>
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-indigo-100 text-indigo-700">OFFICIAL</span>
                                </div>

                                <!-- Body -->
                                <h3 class="text-base font-bold text-slate-900 mb-2 group-hover:text-indigo-600 line-clamp-2 relative z-10 leading-tight">{{ maker.title }}</h3>
                                <p class="text-xs text-slate-500 leading-relaxed line-clamp-3 mb-4 relative z-10">{{ maker.description }}</p>
                            </div>
                        </div>
                    </section>

                    <!-- ‚ë° ÊäïÁ®ø (Firebase) -->
                    <section>
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
                            <h2 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                                <span>‚ú®</span> „Åø„Çì„Å™„ÅÆÊäïÁ®ø ({{ selectedSort === 'popular' ? '‰∫∫Ê∞óÈ†Ü' : 'Êñ∞ÁùÄÈ†Ü' }})
                            </h2>
                            <div class="inline-flex items-center bg-white border border-slate-200 rounded-xl p-1">
                                <button
                                    @click="selectSort('new')"
                                    :class="['px-3 py-1.5 text-xs font-bold rounded-lg transition', selectedSort === 'new' ? 'bg-slate-900 text-white' : 'text-slate-500 hover:text-slate-800']"
                                >Êñ∞ÁùÄÈ†Ü</button>
                                <button
                                    @click="selectSort('popular')"
                                    :class="['px-3 py-1.5 text-xs font-bold rounded-lg transition', selectedSort === 'popular' ? 'bg-slate-900 text-white' : 'text-slate-500 hover:text-slate-800']"
                                >‰∫∫Ê∞óÈ†Ü</button>
                            </div>
                        </div>
                        
                        <div v-if="isFetching" class="text-center py-10">
                            <div class="inline-block loader border-indigo-200 border-t-indigo-600 w-8 h-8"></div>
                        </div>

                        <div v-else class="flex overflow-x-auto gap-4 px-4 -mx-4 pb-4 md:grid md:grid-cols-2 lg:grid-cols-3 md:gap-6 md:px-0 md:mx-0 md:pb-0 scrollbar-hide snap-x">
                            <div 
                                v-for="maker in filteredMakers"
                                :key="maker.id"
                                @click="selectMaker(maker)"
                                class="flex-shrink-0 w-80 md:w-auto snap-center relative overflow-hidden bg-white p-5 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer group h-full flex flex-col"
                            >
                                <!-- Watermark Emoji -->
                                <div class="absolute -bottom-6 -right-6 text-9xl opacity-5 pointer-events-none group-hover:scale-110 transition-transform duration-500 rotate-12 select-none">
                                    {{ maker.emoji }}
                                </div>

                                <!-- Header -->
                                <div class="flex items-start justify-between mb-3 relative z-10">
                                    <span class="text-4xl shadow-sm rounded-lg p-1 bg-slate-50/50 backdrop-blur-sm">{{ maker.emoji }}</span>
                                    <div class="flex flex-col items-end gap-1">
                                         <span v-if="maker.category" class="text-[10px] font-bold px-2 py-0.5 rounded bg-slate-100 text-slate-500">
                                            {{ categories.find(c => c.id === maker.category)?.label || maker.category }}
                                        </span>
                                        <button @click="toggleLike(maker, $event)" :disabled="!!likingInProgress[maker.id]" :class="['flex items-center gap-1 transition px-2 py-1 rounded-full bg-white/80 backdrop-blur-sm border border-slate-100 shadow-sm', likingInProgress[maker.id] ? 'text-slate-300 cursor-not-allowed' : 'text-slate-400 hover:text-pink-500']">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" :fill="userLikes[maker.id] ? '#ec4899' : 'none'" :stroke="userLikes[maker.id] ? '#ec4899' : 'currentColor'" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                            <span class="text-[10px] font-bold">{{ maker.likesCount || 0 }}</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Body -->
                                <h3 class="text-base font-bold text-slate-900 mb-2 group-hover:text-indigo-600 line-clamp-2 relative z-10 leading-tight">{{ maker.title }}</h3>
                                <p class="text-xs text-slate-500 leading-relaxed line-clamp-3 mb-4 relative z-10">{{ maker.description }}</p>

                                <!-- Footer -->
                                <div v-if="maker.tags && maker.tags.length" class="mt-auto flex flex-wrap gap-1 relative z-10 pt-3 border-t border-slate-50">
                                    <span
                                        v-for="tag in maker.tags.slice(0, 3)"
                                        :key="tag"
                                        @click="selectTag(tag, $event)"
                                        class="text-[9px] bg-slate-50 border border-slate-100 px-2 py-0.5 rounded-full text-slate-400 hover:text-indigo-600 hover:border-indigo-200 transition"
                                    >#{{ tag }}</span>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- MY MAKERSÁîªÈù¢ -->
                <div v-else-if="viewMode === 'my_makers'" key="my_makers">
                    <div class="mb-8 flex items-center gap-4">
                        <button @click="goHome" class="flex items-center text-slate-500 hover:text-indigo-600 transition font-medium">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
                        <h1 class="text-2xl font-bold text-slate-900">Ëá™ÂàÜ„ÅÆÊäïÁ®ø‰∏ÄË¶ß</h1>
                    </div>

                    <div v-if="isFetchingMyMakers" class="text-center py-10">
                        <div class="inline-block loader border-indigo-200 border-t-indigo-600 w-8 h-8"></div>
                    </div>

                    <div v-else-if="myMakers.length === 0" class="text-center py-12 bg-white rounded-2xl border border-slate-200">
                        <div class="text-5xl mb-4">üìù</div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">„Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                        <p class="text-slate-500 mb-6">„Ç™„É™„Ç∏„Éä„É´„ÅÆAI„É°„Éº„Ç´„Éº„Çí‰Ωú„Å£„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                        <a href="creator.html" class="bg-indigo-600 text-white font-bold px-6 py-3 rounded-xl hover:bg-indigo-700 transition inline-block">
                            + Êñ∞„Åó„Åè‰Ωú„Çã
                        </a>
                    </div>

                    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div
                            v-for="maker in myMakers"
                            :key="maker.id"
                            @click="selectMaker(maker)"
                            class="relative overflow-hidden bg-white p-5 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer group h-full flex flex-col"
                        >
                            <!-- Watermark -->
                            <div class="absolute -bottom-6 -right-6 text-9xl opacity-5 pointer-events-none group-hover:scale-110 transition-transform duration-500 rotate-12 select-none">{{ maker.emoji }}</div>

                            <!-- Header -->
                            <div class="flex items-start justify-between mb-3 relative z-10">
                                <span class="text-4xl shadow-sm rounded-lg p-1 bg-slate-50/50 backdrop-blur-sm">{{ maker.emoji }}</span>
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-indigo-100 text-indigo-600 uppercase">MY MAKER</span>
                            </div>

                            <!-- Body -->
                            <h3 class="text-base font-bold text-slate-900 mb-2 group-hover:text-indigo-600 line-clamp-2 relative z-10 leading-tight">{{ maker.title }}</h3>
                            <p class="text-xs text-slate-500 leading-relaxed line-clamp-3 mb-4 relative z-10">{{ maker.description }}</p>

                            <!-- Footer -->
                            <div class="mt-auto text-[10px] text-slate-400 font-mono relative z-10 pt-3 border-t border-slate-50">
                                {{ new Date(maker.createdAt?.seconds * 1000).toLocaleDateString() }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LIKED MAKERSÁîªÈù¢ -->
                <div v-else-if="viewMode === 'liked'" key="liked">
                    <div class="mb-8 flex items-center gap-4">
                        <button @click="goHome" class="flex items-center text-slate-500 hover:text-indigo-600 transition font-medium">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
                        <h1 class="text-2xl font-bold text-slate-900">„ÅäÊ∞ó„Å´ÂÖ•„Çä</h1>
                    </div>

                    <div v-if="isFetchingMyMakers" class="text-center py-10">
                        <div class="inline-block loader border-indigo-200 border-t-indigo-600 w-8 h-8"></div>
                    </div>

                    <div v-else-if="likedMakers.length === 0" class="text-center py-12 bg-white rounded-2xl border border-slate-200">
                        <div class="text-5xl mb-4">üíñ</div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">„Åæ„Å†„ÅäÊ∞ó„Å´ÂÖ•„Çä„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                        <p class="text-slate-500 mb-6">Ê∞ó„Å´ÂÖ•„Å£„Åü„É°„Éº„Ç´„Éº„Å´„Äå„ÅÑ„ÅÑ„Å≠„Äç„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                    </div>

                    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div
                            v-for="maker in likedMakers"
                            :key="maker.id"
                            @click="selectMaker(maker)"
                            class="relative overflow-hidden bg-white p-5 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer group h-full flex flex-col"
                        >
                            <!-- Watermark -->
                            <div class="absolute -bottom-6 -right-6 text-9xl opacity-5 pointer-events-none group-hover:scale-110 transition-transform duration-500 rotate-12 select-none">{{ maker.emoji }}</div>

                            <!-- Header -->
                            <div class="flex items-start justify-between mb-3 relative z-10">
                                <span class="text-4xl shadow-sm rounded-lg p-1 bg-slate-50/50 backdrop-blur-sm">{{ maker.emoji }}</span>
                                <button @click="toggleLike(maker, $event)" :disabled="!!likingInProgress[maker.id]" :class="['flex items-center gap-1 transition px-2 py-1 rounded-full bg-white/80 backdrop-blur-sm border border-slate-100 shadow-sm', likingInProgress[maker.id] ? 'text-slate-300 cursor-not-allowed' : 'text-pink-500']">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#ec4899" stroke="#ec4899" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                    <span class="text-[10px] font-bold">{{ maker.likesCount || 0 }}</span>
                                </button>
                            </div>

                            <!-- Body -->
                            <h3 class="text-base font-bold text-slate-900 mb-2 group-hover:text-indigo-600 line-clamp-2 relative z-10 leading-tight">{{ maker.title }}</h3>
                            <p class="text-xs text-slate-500 leading-relaxed line-clamp-3 mb-4 relative z-10">{{ maker.description }}</p>
                        </div>
                    </div>
                </div>

                <!-- HISTORYÁîªÈù¢ -->
                <div v-else-if="viewMode === 'history'" key="history">
                    <div class="mb-8 flex items-center gap-4">
                        <button @click="goHome" class="flex items-center text-slate-500 hover:text-indigo-600 transition font-medium">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
                        <h1 class="text-2xl font-bold text-slate-900">Èñ≤Ë¶ßÂ±•Ê≠¥</h1>
                    </div>

                    <div v-if="historyMakers.length === 0" class="text-center py-12 bg-white rounded-2xl border border-slate-200">
                        <div class="text-5xl mb-4">üïí</div>
                        <h3 class="text-lg font-bold text-slate-900 mb-2">Â±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                    </div>

                    <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div
                            v-for="maker in historyMakers"
                            :key="maker.id"
                            @click="selectMaker(maker)"
                            class="relative overflow-hidden bg-white p-5 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md hover:border-indigo-300 transition-all cursor-pointer group h-full flex flex-col"
                        >
                            <!-- Watermark -->
                            <div class="absolute -bottom-6 -right-6 text-9xl opacity-5 pointer-events-none group-hover:scale-110 transition-transform duration-500 rotate-12 select-none">{{ maker.emoji }}</div>

                            <div class="flex items-start justify-between mb-3 relative z-10">
                                <span class="text-4xl shadow-sm rounded-lg p-1 bg-slate-50/50 backdrop-blur-sm">{{ maker.emoji }}</span>
                            </div>
                            <h3 class="text-base font-bold text-slate-900 mb-2 group-hover:text-indigo-600 line-clamp-2 relative z-10 leading-tight">{{ maker.title }}</h3>
                            <p class="text-xs text-slate-500 leading-relaxed line-clamp-3 mb-4 relative z-10">{{ maker.description }}</p>
                            <div class="mt-auto text-[10px] text-slate-400 font-mono relative z-10 pt-3 border-t border-slate-50">
                                Viewed: {{ new Date(maker.viewedAt).toLocaleDateString() }} {{ new Date(maker.viewedAt).toLocaleTimeString() }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PLAYÁîªÈù¢ -->
                <div v-else-if="viewMode === 'play'" key="play" class="max-w-2xl mx-auto">
                    <button @click="goHome" class="mb-6 flex items-center text-slate-500 hover:text-indigo-600 transition font-medium">‚Üê ‰∏ÄË¶ß„Å´Êàª„Çã</button>
                    <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-200">
                        <div class="p-8 pb-4 text-center bg-gradient-to-b from-slate-50 to-white relative">
                            <!-- Actions -->
                            <div class="absolute top-4 right-4 flex gap-2">
                                <button @click="toggleLike(currentMaker)" :disabled="isOfficialMaker(currentMaker) || !!likingInProgress[currentMaker.id]" :class="['transition p-2 rounded-full flex items-center gap-1 bg-white/50 backdrop-blur-sm shadow-sm border border-slate-100', (isOfficialMaker(currentMaker) || likingInProgress[currentMaker.id]) ? 'text-slate-300 cursor-not-allowed' : 'text-slate-400 hover:text-pink-500 hover:bg-pink-50']" :title="isOfficialMaker(currentMaker) ? 'ÂÖ¨Âºè„É°„Éº„Ç´„Éº„ÅØ„ÅÑ„ÅÑ„Å≠ÂØæË±°Â§ñ„Åß„Åô' : (likingInProgress[currentMaker.id] ? '„ÅÑ„ÅÑ„Å≠Âá¶ÁêÜ‰∏≠...' : '„ÅÑ„ÅÑ„Å≠')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" :fill="userLikes[currentMaker.id] ? '#ec4899' : 'none'" :stroke="userLikes[currentMaker.id] ? '#ec4899' : 'currentColor'" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                    <span class="text-sm font-bold" :class="userLikes[currentMaker.id] ? 'text-pink-500' : ''">{{ currentMaker.likesCount || 0 }}</span>
                                </button>
                                <button v-if="!isOfficialMaker(currentMaker)" @click="toggleReportBox" class="text-slate-400 hover:text-amber-600 transition p-2 rounded-full hover:bg-amber-50 bg-white/50 backdrop-blur-sm shadow-sm border border-slate-100" title="„Åì„ÅÆ„É°„Éº„Ç´„Éº„ÇíÈÄöÂ†±">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line></svg>
                                </button>
                                <button v-if="user && currentMaker.authorId === user.uid" @click="deleteMaker" class="text-slate-400 hover:text-red-500 transition p-2 rounded-full hover:bg-red-50 bg-white/50 backdrop-blur-sm shadow-sm border border-slate-100" title="„Åì„ÅÆ„É°„Éº„Ç´„Éº„ÇíÂâäÈô§">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                                </button>
                            </div>

                            <div class="text-5xl mb-4">{{ currentMaker.emoji }}</div>
                            <h2 class="text-2xl font-bold text-slate-900">{{ currentMaker.title }}</h2>

                            <!-- Remix Origin Credit -->
                            <div v-if="currentMaker.remixOriginId" class="mt-1">
                                <a :href="'?id=' + currentMaker.remixOriginId" class="text-xs text-indigo-500 hover:text-indigo-700 font-bold flex items-center justify-center gap-1">
                                    <span>‚ôªÔ∏è Remix of {{ currentMaker.remixOriginTitle || 'Original' }}</span>
                                </a>
                            </div>

                            <p class="text-slate-500 text-sm mt-2">{{ currentMaker.description }}</p>

                            <!-- Remix This Button -->
                            <div class="mt-4">
                                <a :href="'creator.html?remix_id=' + currentMaker.id" class="text-xs text-slate-400 hover:text-indigo-600 border border-slate-200 px-3 py-1 rounded-full bg-white hover:bg-indigo-50 transition inline-flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2.1l4 4-4 4"/><path d="M3 12.2v-2a4 4 0 0 1 4-4h12.8M7 21.9l-4-4 4-4"/><path d="M21 11.8v2a4 4 0 0 1-4 4H4.2"/></svg>
                                    „Åì„ÅÆ„É°„Éº„Ç´„Éº„Çí„É™„Éü„ÉÉ„ÇØ„Çπ
                                </a>
                            </div>
                        </div>
                        <div class="p-6 md:p-8 space-y-6">
                            <div v-if="showReportBox && !isOfficialMaker(currentMaker)" class="bg-amber-50 border border-amber-200 rounded-xl p-4">
                                <h3 class="text-sm font-bold text-amber-800 mb-2">„Åì„ÅÆ„É°„Éº„Ç´„Éº„ÇíÈÄöÂ†±</h3>
                                <textarea v-model="reportReason" class="w-full h-24 p-3 border border-amber-200 rounded-lg bg-white text-sm resize-none focus:ring-2 focus:ring-amber-300" placeholder="ÈÄöÂ†±ÁêÜÁî±„ÇíÂÖ∑‰ΩìÁöÑ„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                                <div class="mt-3 flex items-center justify-between gap-2">
                                    <span v-if="reportError" class="text-xs text-red-500 font-bold">{{ reportError }}</span>
                                    <span v-else class="text-xs text-slate-500">‚ÄªÊÇ™Ë≥™„Å™ÈÄöÂ†±„ÅØ„Ç¢„Ç´„Ç¶„É≥„ÉàÂà∂ÈôêÂØæË±°„Å´„Å™„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</span>
                                    <button @click="submitReport" :disabled="isSubmittingReport" class="bg-amber-600 hover:bg-amber-700 text-white text-xs font-bold px-4 py-2 rounded-lg disabled:opacity-60">
                                        {{ isSubmittingReport ? 'ÈÄÅ‰ø°‰∏≠...' : 'ÈÄöÂ†±„ÇíÈÄÅ‰ø°' }}
                                    </button>
                                </div>
                            </div>
                            <textarea v-model="inputText" class="w-full h-32 p-4 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 transition-all resize-none bg-slate-50" :placeholder="currentMaker.placeholder || '„Åì„Åì„Å´„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ...'"></textarea>
                            <button @click="convertText" :disabled="!inputText || isLoading" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg transition flex justify-center items-center gap-2">
                                <span v-if="isLoading" class="loader"></span>
                                <span v-if="!isLoading">Â§âÊèõ„Çπ„Çø„Éº„Éà ‚ö°</span>
                            </button>
                            <!-- ÁµêÊûúË°®Á§∫„Ç®„É™„Ç¢ -->
                            <div v-if="outputText" class="bg-indigo-50 rounded-xl p-6 border border-indigo-100 mt-4 animate-fade-in">
                                <div class="text-slate-800 leading-relaxed whitespace-pre-wrap">{{ outputText }}</div>
                                <!-- „Ç∑„Çß„Ç¢„Éú„Çø„É≥ -->
                                <div class="mt-4 pt-4 border-t border-indigo-200 grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <button @click="shareResultOnSite" :disabled="isSharingResult" class="w-full bg-teal-600 text-white font-bold py-3 rounded-xl hover:bg-teal-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <span v-if="isSharingResult" class="loader w-4 h-4 border-2"></span>
                                        <span v-else>üåê „Çµ„Ç§„Éà„ÅßÂÖ±Êúâ</span>
                                    </button>
                                    <button @click="shareOnTwitter" class="w-full bg-black text-white font-bold py-3 rounded-xl hover:bg-gray-800 transition flex items-center justify-center gap-2">
                                        <span>ùïè „Åß„Éù„Çπ„Éà</span>
                                    </button>
                                    <button @click="generateAndShareImage" :disabled="isGeneratingImage" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                        <span v-if="isGeneratingImage" class="loader w-4 h-4 border-2"></span>
                                        <span v-else>üì∑ ÁîªÂÉè„Åß„Ç∑„Çß„Ç¢</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shared Results List -->
                    <div v-if="makerSharedResults.length > 0" class="mt-8 mb-8">
                        <h3 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">
                            <span>üí¨</span> „Åø„Çì„Å™„ÅÆÂ§âÊèõÁµêÊûú
                        </h3>
                        <div class="space-y-4">
                            <div
                                v-for="result in makerSharedResults"
                                :key="result.id"
                                class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200"
                            >
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 h-6 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500">
                                            {{ result.authorName.charAt(0).toUpperCase() }}
                                        </div>
                                        <span class="text-xs font-bold text-slate-600">{{ result.authorName }}</span>
                                    </div>
                                    <div class="text-[10px] text-slate-400">
                                        {{ result.createdAt?.seconds ? new Date(result.createdAt.seconds * 1000).toLocaleDateString() : 'Now' }}
                                    </div>
                                </div>

                                <div class="bg-slate-50 p-3 rounded-lg border border-slate-100 mb-3">
                                    <div class="text-xs text-slate-400 font-bold mb-1">Before</div>
                                    <div class="text-sm text-slate-600 line-clamp-2">{{ result.inputText }}</div>
                                </div>

                                <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100 mb-3">
                                    <div class="text-xs text-indigo-400 font-bold mb-1">After</div>
                                    <div class="text-sm text-slate-800 font-medium whitespace-pre-wrap">{{ result.outputText }}</div>
                                </div>

                                <div class="flex justify-end">
                                    <button @click="toggleLikeResult(result, $event)" class="flex items-center gap-1.5 text-slate-400 hover:text-pink-500 transition px-2 py-1 rounded-full hover:bg-pink-50">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" :fill="userLikedResults[result.id] ? '#ec4899' : 'none'" :stroke="userLikedResults[result.id] ? '#ec4899' : 'currentColor'" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                        <span class="text-xs font-bold" :class="userLikedResults[result.id] ? 'text-pink-500' : ''">{{ result.likesCount || 0 }}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Remixes List -->
                    <div v-if="remixes.length > 0" class="mt-8 mb-8">
                        <h3 class="text-sm font-bold text-slate-500 mb-4 flex items-center gap-2">
                            <span>‚ôªÔ∏è</span> „Åì„ÅÆ‰ΩúÂìÅ„ÅÆ„É™„Éü„ÉÉ„ÇØ„Çπ
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div
                                v-for="remix in remixes"
                                :key="remix.id"
                                @click="selectMaker(remix)"
                                class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition cursor-pointer flex items-center gap-3"
                            >
                                <span class="text-2xl">{{ remix.emoji }}</span>
                                <div class="overflow-hidden">
                                    <h4 class="font-bold text-slate-900 text-sm truncate">{{ remix.title }}</h4>
                                    <p class="text-xs text-slate-500 truncate">{{ remix.description }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </transition>
        </main>

        <!-- „Éï„ÉÉ„Çø„Éº -->
        <footer class="p-6 text-center text-slate-400 text-xs space-y-3 border-t border-slate-200 mt-8">
            <div class="flex justify-center gap-4">
                <button @click="showTermsModal = true" class="hover:text-slate-600 underline">Âà©Áî®Ë¶èÁ¥Ñ</button>
                <button @click="showPrivacyModal = true" class="hover:text-slate-600 underline">„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</button>
                <button @click="showOperatorModal = true" class="hover:text-slate-600 underline">ÈÅãÂñ∂ËÄÖÊÉÖÂ†±</button>
            </div>
            <p>¬© 2024 TextMimic by Tokyo10104184</p>
        </footer>

        <!-- „É≠„Ç∞„Ç§„É≥„É¢„Éº„ÉÄ„É´ -->
        <div v-if="showAuthModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showAuthModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full mx-4 relative">
                <button @click="showAuthModal = false" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 text-2xl">&times;</button>

                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">{{ authMode === 'login' ? '„É≠„Ç∞„Ç§„É≥' : '„Ç¢„Ç´„Ç¶„É≥„ÉàÁôªÈå≤' }}</h2>
                    <p class="text-xs text-slate-500">„Ç¢„Ç´„Ç¶„É≥„Éà„Çí‰Ωø„Å£„Å¶TextMimic„Çí„ÇÇ„Å£„Å®‰æøÂà©„Å´„ÄÇ</p>
                </div>

                <div class="space-y-4">
                    <button @click="loginWithGoogle" class="w-full bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 shadow-sm">
                        <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                        Google„Åß{{ authMode === 'login' ? '„É≠„Ç∞„Ç§„É≥' : 'ÁôªÈå≤' }}
                    </button>

                    <div class="relative flex py-2 items-center">
                        <div class="flex-grow border-t border-slate-200"></div>
                        <span class="flex-shrink-0 mx-4 text-slate-400 text-xs font-bold">OR</span>
                        <div class="flex-grow border-t border-slate-200"></div>
                    </div>

                    <!-- Email Form -->
                    <form @submit.prevent="handleEmailAuth" class="space-y-3">
                        <div>
                            <input v-model="email" type="email" placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ" class="w-full p-3 border border-slate-300 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none transition" required>
                        </div>
                        <div>
                            <input v-model="password" type="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ" class="w-full p-3 border border-slate-300 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none transition" required minlength="6">
                        </div>

                        <button type="submit" :disabled="authLoading" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 rounded-xl transition shadow flex justify-center items-center">
                            <span v-if="authLoading" class="loader w-4 h-4 border-2"></span>
                            <span v-else>{{ authMode === 'login' ? '„É≠„Ç∞„Ç§„É≥' : '„Ç¢„Ç´„Ç¶„É≥„ÉàÁôªÈå≤' }}</span>
                        </button>
                    </form>

                    <div v-if="authError" class="text-red-500 text-xs text-center font-bold bg-red-50 p-2 rounded-lg">
                        {{ authError }}
                    </div>

                    <div class="text-center">
                        <button @click="toggleAuthMode" class="text-indigo-600 text-xs font-bold hover:underline">
                            {{ authMode === 'login' ? '„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑÊñπ„ÅØÁôªÈå≤' : '„Åô„Åß„Å´„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„ÅÆÊñπ„ÅØ„É≠„Ç∞„Ç§„É≥' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
        <div v-if="showSettingsModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showSettingsModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-slate-900">‚öôÔ∏è Ë®≠ÂÆö</h2>
                    <button @click="showSettingsModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-700 mb-2">AI„É¢„Éá„É´</label>
                        <select v-model="selectedModel" class="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none appearance-none">
                            <option v-for="model in availableModels" :key="model.id" :value="model.id">
                                {{ model.name }}
                            </option>
                        </select>
                        <p class="text-xs text-slate-400 mt-2">‚Äª „É¢„Éá„É´„Å´„Çà„Å£„Å¶ÁîüÊàêÈÄüÂ∫¶„ÇÑÂìÅË≥™„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇ</p>
                    </div>
                </div>

                <div class="mt-8">
                    <button @click="showSettingsModal = false" class="w-full bg-slate-900 text-white font-bold py-3 rounded-xl hover:bg-slate-800 transition">
                        OK
                    </button>
                </div>
            </div>
        </div>

        <!-- Âà©Áî®Ë¶èÁ¥Ñ„É¢„Éº„ÉÄ„É´ -->
        <div v-if="showTermsModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showTermsModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">üìú Âà©Áî®Ë¶èÁ¥Ñ</h2>
                    <button @click="showTermsModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                <div class="text-sm text-slate-600 space-y-4">
                    <p class="text-xs text-slate-400">ÊúÄÁµÇÊõ¥Êñ∞Êó•: 2025Âπ¥12Êúà11Êó•</p>
                    
                    <h3 class="font-bold text-slate-800">Á¨¨1Êù°ÔºàÈÅ©Áî®Ôºâ</h3>
                    <p>Êú¨Ë¶èÁ¥Ñ„ÅØ„ÄÅTokyo10104184Ôºà‰ª•‰∏ã„ÄåÈÅãÂñ∂ËÄÖ„ÄçÔºâ„ÅåÊèê‰æõ„Åô„Çã„ÄåTextMimic„ÄçÔºà‰ª•‰∏ã„ÄåÊú¨„Çµ„Éº„Éì„Çπ„ÄçÔºâ„ÅÆÂà©Áî®„Å´Èñ¢„Åô„ÇãÊù°‰ª∂„ÇíÂÆö„ÇÅ„Çã„ÇÇ„ÅÆ„Åß„Åô„ÄÇ</p>
                    
                    <h3 class="font-bold text-slate-800">Á¨¨2Êù°ÔºàÁ¶ÅÊ≠¢‰∫ãÈ†ÖÔºâ</h3>
                    <p>Âà©Áî®ËÄÖ„ÅØ‰ª•‰∏ã„ÅÆË°åÁÇ∫„ÇíË°å„Å£„Å¶„ÅØ„Å™„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>Ê≥ï‰ª§„Åæ„Åü„ÅØÂÖ¨Â∫èËâØ‰øó„Å´Âèç„Åô„ÇãÂÜÖÂÆπ„ÅÆÊäïÁ®ø„ÉªÁîüÊàê</li>
                        <li>‰ªñËÄÖ„ÅÆÊ®©Âà©ÔºàËëó‰ΩúÊ®©„ÄÅ„Éó„É©„Ç§„Éê„Ç∑„ÉºÊ®©„ÄÅÂêçË™âÁ≠âÔºâ„Çí‰æµÂÆ≥„Åô„ÇãË°åÁÇ∫</li>
                        <li>ÁäØÁΩ™Ë°åÁÇ∫„ÇíÂä©Èï∑„Åæ„Åü„ÅØ‰øÉÈÄ≤„Åô„ÇãÂÜÖÂÆπ„ÅÆ‰ΩúÊàê</li>
                        <li>ËôöÂÅΩ„ÅÆÊÉÖÂ†±„ÇíÊã°Êï£„Åô„ÇãÁõÆÁöÑ„Åß„ÅÆÂà©Áî®</li>
                        <li>Êú¨„Çµ„Éº„Éì„Çπ„ÅÆ„Çµ„Éº„Éê„Éº„ÇÑ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Å´ÈÅéÂ∫¶„Å™Ë≤†Ëç∑„Çí„Åã„Åë„ÇãË°åÁÇ∫</li>
                        <li>Êú¨„Çµ„Éº„Éì„Çπ„ÅÆÈÅãÂñ∂„ÇíÂ¶®ÂÆ≥„Åô„ÇãË°åÁÇ∫</li>
                        <li>Á¨¨‰∏âËÄÖ„Å´„Å™„Çä„Åô„Åæ„ÅôË°åÁÇ∫</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">Á¨¨3Êù°Ôºà„É¶„Éº„Ç∂„ÉºÊäïÁ®ø„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºâ</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>Âà©Áî®ËÄÖ„Åå‰ΩúÊàê„ÉªÊäïÁ®ø„Åó„Åü„Äå„É°„Éº„Ç´„Éº„ÄçÔºàÂ§âÊèõ„É´„Éº„É´Á≠âÔºâ„ÅØ„ÄÅ‰ªñ„ÅÆÂà©Áî®ËÄÖ„Å´ÂÖ¨Èñã„Åï„Çå„Åæ„Åô„ÄÇ</li>
                        <li>ÈÅãÂñ∂ËÄÖ„ÅØ„ÄÅ‰∏çÈÅ©Âàá„Å®Âà§Êñ≠„Åó„Åü„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çí‰∫àÂëä„Å™„ÅèÂâäÈô§„Åß„Åç„Çã„ÇÇ„ÅÆ„Å®„Åó„Åæ„Åô„ÄÇ</li>
                        <li>ÊäïÁ®øÂÜÖÂÆπ„Å´Èñ¢„Åô„ÇãË≤¨‰ªª„ÅØ„ÄÅÊäïÁ®ø„Åó„ÅüÂà©Áî®ËÄÖ„ÅåË≤†„ÅÜ„ÇÇ„ÅÆ„Å®„Åó„Åæ„Åô„ÄÇ</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">Á¨¨4Êù°ÔºàÂÖçË≤¨‰∫ãÈ†ÖÔºâ</h3>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>Êú¨„Çµ„Éº„Éì„Çπ„ÅØAI„ÇíÊ¥ªÁî®„Åó„Å¶„Åä„Çä„ÄÅÁîüÊàêÁµêÊûú„ÅÆÊ≠£Á¢∫ÊÄß„ÉªÈÅ©ÂàáÊÄß„Çí‰øùË®º„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</li>
                        <li>Êú¨„Çµ„Éº„Éì„Çπ„ÅÆÂà©Áî®„Å´„Çà„ÇäÁîü„Åò„ÅüÊêçÂÆ≥„Å´„Å§„ÅÑ„Å¶„ÄÅÈÅãÂñ∂ËÄÖ„ÅØ‰∏ÄÂàá„ÅÆË≤¨‰ªª„ÇíË≤†„ÅÑ„Åæ„Åõ„Çì„ÄÇ</li>
                        <li>Êú¨„Çµ„Éº„Éì„Çπ„ÅØ‰∫àÂëä„Å™„ÅèÂÜÖÂÆπÂ§âÊõ¥„ÄÅ‰∏ÄÊôÇÂÅúÊ≠¢„ÄÅÁµÇ‰∫Ü„Åô„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">Á¨¨5Êù°ÔºàË¶èÁ¥Ñ„ÅÆÂ§âÊõ¥Ôºâ</h3>
                    <p>ÈÅãÂñ∂ËÄÖ„ÅØ„ÄÅÂøÖË¶Å„Å´Âøú„Åò„Å¶Êú¨Ë¶èÁ¥Ñ„ÇíÂ§âÊõ¥„Åß„Åç„Çã„ÇÇ„ÅÆ„Å®„Åó„Åæ„Åô„ÄÇÂ§âÊõ¥Âæå„ÅÆË¶èÁ¥Ñ„ÅØ„ÄÅÊú¨„Çµ„Éº„Éì„Çπ‰∏ä„Å´Êé≤Ëºâ„Åó„ÅüÊôÇÁÇπ„ÅßÂäπÂäõ„ÇíÁîü„Åò„Åæ„Åô„ÄÇ</p>
                </div>
            </div>
        </div>

        <!-- „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„É¢„Éº„ÉÄ„É´ -->
        <div v-if="showPrivacyModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showPrivacyModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">üîí „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</h2>
                    <button @click="showPrivacyModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                <div class="text-sm text-slate-600 space-y-4">
                    <p class="text-xs text-slate-400">ÊúÄÁµÇÊõ¥Êñ∞Êó•: 2025Âπ¥12Êúà11Êó•</p>
                    
                    <h3 class="font-bold text-slate-800">1. ÂèéÈõÜ„Åô„ÇãÊÉÖÂ†±</h3>
                    <p>Êú¨„Çµ„Éº„Éì„Çπ„Åß„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆÊÉÖÂ†±„ÇíÂèéÈõÜ„Éª‰øùÂ≠ò„Åô„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li><span class="font-medium">ÊäïÁ®ø„Éá„Éº„Çø:</span> Âà©Áî®ËÄÖ„Åå‰ΩúÊàê„Åó„Åü„É°„Éº„Ç´„ÉºÔºà„Çø„Ç§„Éà„É´„ÄÅË™¨ÊòéÊñá„ÄÅ„Éó„É≠„É≥„Éó„Éà„ÄÅÁµµÊñáÂ≠óÔºâ</li>
                        <li><span class="font-medium">Âà©Áî®„É≠„Ç∞:</span> „Ç¢„ÇØ„Çª„ÇπÊó•ÊôÇ„ÄÅ„Éñ„É©„Ç¶„Ç∂ÊÉÖÂ†±Á≠âÔºàGoogle Analytics„Çí‰ΩøÁî®Ôºâ</li>
                        <li><span class="font-medium">ÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„Éà:</span> Â§âÊèõ„ÅÆ„Åü„ÇÅ„Å´AI API„Å∏ÈÄÅ‰ø°„Åï„Çå„Åæ„Åô„Åå„ÄÅÈÅãÂñ∂ËÄÖÂÅ¥„Åß„ÅØ‰øùÂ≠ò„Åó„Åæ„Åõ„Çì</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">2. ÊÉÖÂ†±„ÅÆÂà©Áî®ÁõÆÁöÑ</h3>
                    <p>ÂèéÈõÜ„Åó„ÅüÊÉÖÂ†±„ÅØ‰ª•‰∏ã„ÅÆÁõÆÁöÑ„ÅßÂà©Áî®„Åó„Åæ„Åô„ÄÇ</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>Êú¨„Çµ„Éº„Éì„Çπ„ÅÆÊèê‰æõ„ÉªÈÅãÂñ∂</li>
                        <li>„Çµ„Éº„Éì„ÇπÊîπÂñÑ„ÅÆ„Åü„ÇÅ„ÅÆÂàÜÊûê</li>
                        <li>‰∏çÊ≠£Âà©Áî®„ÅÆÈò≤Ê≠¢</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">3. Á¨¨‰∏âËÄÖ„Å∏„ÅÆÊèê‰æõ</h3>
                    <p>ÈÅãÂñ∂ËÄÖ„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆÂ†¥Âêà„ÇíÈô§„Åç„ÄÅÂÄã‰∫∫ÊÉÖÂ†±„ÇíÁ¨¨‰∏âËÄÖ„Å´Êèê‰æõ„Åó„Åæ„Åõ„Çì„ÄÇ</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li>Ê≥ï‰ª§„Å´Âü∫„Å•„ÅèÈñãÁ§∫Ë´ãÊ±Ç„Åå„ÅÇ„Å£„ÅüÂ†¥Âêà</li>
                        <li>Âà©Áî®ËÄÖ„ÅÆÂêåÊÑè„Åå„ÅÇ„ÇãÂ†¥Âêà</li>
                        <li>„Çµ„Éº„Éì„ÇπÊèê‰æõ„Å´ÂøÖË¶Å„Å™Â§ñÈÉ®„Çµ„Éº„Éì„ÇπÔºàFirebase„ÄÅChutes.aiÁ≠âÔºâ„Å∏„ÅÆÈÄÅ‰ø°</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">4. Â§ñÈÉ®„Çµ„Éº„Éì„Çπ„ÅÆÂà©Áî®</h3>
                    <p>Êú¨„Çµ„Éº„Éì„Çπ„Åß„ÅØ‰ª•‰∏ã„ÅÆÂ§ñÈÉ®„Çµ„Éº„Éì„Çπ„ÇíÂà©Áî®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂêÑ„Çµ„Éº„Éì„Çπ„ÅÆ„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº„ÇÇ„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    <ul class="list-disc list-inside space-y-1 ml-2">
                        <li><span class="font-medium">Google Firebase:</span> „Éá„Éº„Çø‰øùÂ≠ò„Éª„Éõ„Çπ„ÉÜ„Ç£„É≥„Ç∞</li>
                        <li><span class="font-medium">Google Analytics:</span> „Ç¢„ÇØ„Çª„ÇπËß£Êûê</li>
                        <li><span class="font-medium">Chutes.ai:</span> AI„ÉÜ„Ç≠„Çπ„ÉàÁîüÊàê</li>
                    </ul>
                    
                    <h3 class="font-bold text-slate-800">5. „Éá„Éº„Çø„ÅÆ‰øùÊåÅ„ÉªÂâäÈô§</h3>
                    <p>ÊäïÁ®ø„Åï„Çå„Åü„É°„Éº„Ç´„Éº„Éá„Éº„Çø„ÅØ„ÄÅÈÅãÂñ∂ËÄÖ„ÅÆÂà§Êñ≠„Åæ„Åü„ÅØÂà©Áî®ËÄÖ„Åã„Çâ„ÅÆÁî≥„ÅóÂá∫„Å´„Çà„ÇäÂâäÈô§„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂâäÈô§„Çí„ÅîÂ∏åÊúõ„ÅÆÂ†¥Âêà„ÅØ„ÄÅÈÅãÂñ∂ËÄÖ„Åæ„Åß„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    
                    <h3 class="font-bold text-slate-800">6. „ÅäÂïè„ÅÑÂêà„Çè„Åõ</h3>
                    <p>Êú¨„Éù„É™„Ç∑„Éº„Å´Èñ¢„Åô„Çã„ÅäÂïè„ÅÑÂêà„Çè„Åõ„ÅØ„ÄÅÈÅãÂñ∂ËÄÖ„Åæ„Åß„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                </div>
            </div>
        </div>

        <!-- ÈÅãÂñ∂ËÄÖÊÉÖÂ†±„É¢„Éº„ÉÄ„É´ -->
        <div v-if="showOperatorModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay" @click.self="showOperatorModal = false">
            <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-md mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">üë§ ÈÅãÂñ∂ËÄÖÊÉÖÂ†±</h2>
                    <button @click="showOperatorModal = false" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
                </div>
                <div class="text-sm text-slate-600 space-y-3">
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <table class="w-full">
                            <tr>
                                <td class="font-bold text-slate-700 py-2">ÈÅãÂñ∂ËÄÖÂêç</td>
                                <td class="py-2">Tokyo10104184</td>
                            </tr>
                            <tr>
                                <td class="font-bold text-slate-700 py-2">„Çµ„Éº„Éì„ÇπÂêç</td>
                                <td class="py-2">TextMimic</td>
                            </tr>
                            <tr>
                                <td class="font-bold text-slate-700 py-2">„ÅäÂïè„ÅÑÂêà„Çè„Åõ</td>
                                <td class="py-2">
                                    <span class="text-slate-400">[SNSÁ≠â„Åß„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ]</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <p class="text-xs text-slate-400">
                        ‚Äª ‰∏çÈÅ©Âàá„Å™„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆÂ†±Âëä„ÇÑÂâäÈô§‰æùÈ†º„Å™„Å©„ÅØ„ÄÅ‰∏äË®òÈÄ£Áµ°ÂÖà„Åæ„Åß„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
                    </p>
                </div>
            </div>
        </div>

        <!-- ÁîªÂÉèÁîüÊàêÁî®„ÉÜ„É≥„Éó„É¨„Éº„Éà (ÈùûË°®Á§∫) -->
        <div id="share-image-template" class="fixed left-[-9999px] top-0 w-[600px] bg-white p-8 rounded-none pointer-events-none">
            <div class="space-y-6">
                <!-- Header -->
                <div class="flex items-center gap-3 border-b border-slate-100 pb-4">
                    <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">M</div>
                    <div>
                        <h1 class="text-2xl font-extrabold tracking-tight text-slate-900 leading-none">TextMimic</h1>
                        <p class="text-xs text-slate-400 font-bold mt-1">AI„ÉÜ„Ç≠„Çπ„ÉàÂ§âÊèõ„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</p>
                    </div>
                </div>

                <!-- Content -->
                <div class="space-y-4">
                    <!-- Before -->
                    <div class="relative">
                        <span class="absolute -top-3 left-3 bg-slate-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-10">BEFORE</span>
                        <div class="bg-slate-100 p-5 pt-6 rounded-2xl border border-slate-200 text-slate-600 text-sm leading-relaxed whitespace-pre-wrap font-medium">
                            {{ inputText || 'ÔºàÂÖ•Âäõ„ÉÜ„Ç≠„Çπ„ÉàÔºâ' }}
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="flex justify-center text-indigo-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                    </div>

                    <!-- After -->
                    <div class="relative">
                        <span class="absolute -top-3 left-3 bg-indigo-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-full z-10">AFTER</span>
                        <div class="bg-indigo-50 p-6 pt-7 rounded-2xl border border-indigo-100 text-slate-900 text-lg font-bold leading-relaxed whitespace-pre-wrap shadow-sm">
                            {{ outputText || 'ÔºàÂ§âÊèõÂæå„ÅÆ„ÉÜ„Ç≠„Çπ„ÉàÔºâ' }}
                        </div>
                        <!-- Maker Info Badge -->
                        <div class="absolute bottom-3 right-3 flex items-center gap-2 bg-white/80 backdrop-blur px-3 py-1.5 rounded-lg border border-indigo-100 shadow-sm">
                            <span class="text-xl">{{ currentMaker?.emoji }}</span>
                            <span class="text-xs font-bold text-slate-700">{{ currentMaker?.title }}</span>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex justify-between items-end pt-4 border-t border-slate-100 mt-2">
                    <div class="text-[10px] text-slate-400">
                        Created by <span class="font-bold text-indigo-600">TextMimic</span>
                    </div>
                    <div class="text-[10px] text-slate-400 font-mono">
                        textmimic.web.app
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Environment Variables -->
    <script src="env.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, orderBy, query, limit, doc, getDoc, where, deleteDoc, runTransaction, setDoc, serverTimestamp, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { OPENROUTER_API_KEY, firebaseConfig, CATEGORIES } from './config.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // „É¢„Éº„ÉÄ„É´
                    showTermsModal: false,
                    showPrivacyModal: false,
                    showOperatorModal: false,
                    showSettingsModal: false,
                    showAuthModal: false,
                    showUserMenu: false,
                    // Auth State
                    user: null,
                    authInitialized: false,
                    authMode: 'login', // 'login' or 'register'
                    email: '',
                    password: '',
                    authError: '',
                    authLoading: false,

                    // Ë®≠ÂÆö
                    selectedModel: 'stepfun/step-3.5-flash:free',
                    availableModels: [
                        { id: 'stepfun/step-3.5-flash:free', name: 'stepfun/step-3.5-flash:free' },
                        { id: 'openrouter/aurora-alpha', name: 'aurora-alpha' }
                    ],
                    // ‚ë† ÂÖ¨Âºè„É°„Éº„Ç´„ÉºÔºà„Éó„É™„Çª„ÉÉ„ÉàÔºâ
                    officialMakers: [
                        { id: 'off_1', emoji: 'üòá', title: 'ËÅñ‰∫∫ÂêõÂ≠ê„É°„Éº„É´', description: 'ÊÄí„Çä„ÇíÊ•µ„ÇÅ„Å¶ÂÜ∑Èùô„Å™„Éì„Ç∏„Éç„Çπ„É°„Éº„É´„Å´„ÄÇ', systemPrompt: '„ÅÇ„Å™„Åü„ÅØË∂Ö‰∏ÄÊµÅ„ÅÆ„Éì„Ç∏„Éç„Çπ„Éû„É≥„Åß„Åô„ÄÇÊÑüÊÉÖÁöÑ„Å™ÊñáÁ´†„Çí„ÄÅÊÑèÂë≥„ÇíÂ§â„Åà„Åö„Å´‰∏ÅÂØß„ÅßÂÜÜÊªë„Å™„Éì„Ç∏„Éç„Çπ„É°„Éº„É´„Å´Êõ∏„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' },
                        { id: 'off_2', emoji: 'üç∫', title: '„Åä„Åò„Åï„ÇìÊßãÊñá', description: 'ÊñáÁ´†„ÇíÁµµÊñáÂ≠óÂ§ö„ÇÅ„ÅÆÈ¶¥„ÇåÈ¶¥„Çå„Åó„ÅÑ„Åä„Åò„Åï„Çì„Å´„ÄÇ', systemPrompt: '[ÂΩπÂâ≤]„ÅÇ„Å™„Åü„ÅØ„Äå„Åä„Åò„Åï„ÇìÊßãÊñáÂ∞ÇÈñÄÂ§âÊèõAI„Äç„Å†„ÄÇ„Å©„Çì„Å™ÊôÆÈÄö„ÅÆÊó•Êú¨Ë™û„ÅÆÊñá„Åß„ÇÇ„ÄÅÂæπÂ∫ïÁöÑ„Å´„ÇØ„Çª„ÅÆÂº∑„ÅÑ„Äå„Åä„Åò„Åï„ÇìÊßãÊñá„Äç„Å∏Â§âÊèõ„Åõ„Çà„ÄÇ„É¶„Éº„É¢„Ç¢ÈáçË¶ñ„ÄÅ„Å°„Çá„Å£„Å®Ê∞óÊåÅ„Å°ÊÇ™„ÅÑ„Åè„Çâ„ÅÑË¶™„Åó„Åí„ÅßÈÅéÂâ∞„Å™Ë°®Áèæ„Å´„Åô„Çã„Åì„Å®„ÄÇ„Å†„ÅåÁõ∏Êâã„Çí‰∏≠ÂÇ∑„Åó„Å¶„ÅØ„ÅÑ„Åë„Å™„ÅÑÔºàÊîªÊíÉÁöÑ„Å´Â§â„Åà„Å™„ÅÑÔºâ„ÄÇ[Âá∫Âäõ„Çπ„Çø„Ç§„É´Âü∫Êú¨„É´„Éº„É´]1. ÁµµÊñáÂ≠ó„ÉªÈ°îÊñáÂ≠ó„ÉªË®òÂè∑„Çí**Â§öÁî®**„Åô„ÇãÔºàÊúÄ‰Ωé3„Å§‰ª•‰∏ä„ÄÅÈï∑Êñá„Å™„Çâ5„Äú10ÂÄãÁ®ãÂ∫¶Ôºâ„ÄÇ‰æãÔºöüòäüòÖ‚ú®‚úã‚òïÔ∏è(ÔΩÄÔΩ•œâÔΩ•¬¥)ÔΩ∑ÔæòÔΩØ 2. Áõ∏Êâã„ÅÆÂêçÂâç„ÅØ„Äå‚óØ‚óØ„ÉÅ„É£„É≥„Äç„ÇÑ„Äå‚óØ‚óØ„Åï„Çì„Äç„Å™„Å©Ë¶™„Åó„Åí„Å´„ÄÇËã•„ÅÑÁõ∏ÊâãÊÉ≥ÂÆö„Å™„Çâ„Äå„Äú„ÉÅ„É£„É≥„Äç„Çí„Éá„Éï„Ç©„É´„Éà„Å´„Åô„Çã„ÄÇ3. Âè•Ë™≠ÁÇπ„ÉªÊîπË°å„ÇíÂ§öÁî®„Åó„Å¶**Èï∑„ÇÅ„Å´**Êõ∏„ÅèÔºà1Âõû„ÅÆÂá∫Âäõ„Åß3„Äú6Êñá„ÄÅÂ†¥Âêà„Å´„Çà„Å£„Å¶„ÅØÊÆµËêΩ„ÇíÂàÜ„Åë„ÇãÔºâ„ÄÇ4. Êñá‰∏≠„Å´**„Ç´„Çø„Ç´„ÉäË™û„Çí‰∏çËá™ÁÑ∂„Å´Ê∑∑„Åú„Çã**Ôºà‰æãÔºö„Äå„Çπ„Ç¥„Ç§„Äç„Äå„Çµ„Ç§„Ç≥„Éº„Äç„Äå„Ç¶„É¨„Ç∑„Ç§„Äç„Å™„Å©Ôºâ„ÄÇÁ¢∫‰ø°Â∫¶È´ò„Åè‰Ωø„ÅÜ„ÄÇ5. Ëá™ÂàÜË™û„ÇäÔºà„Äå„Åä„Åò„Åï„Çì„ÅØ„Å≠„Äú„Äç„Äå„Å®„Åì„Çç„Åß„Ç™„Ç∏„Çµ„É≥„ÄÅÊò®Êó•‚Ä¶„ÄçÔºâ„ÇíÂøÖ„Åö1ÁÆáÊâÄ‰ª•‰∏äÊåøÂÖ•„Åô„Çã„ÄÇ6. ‰∫àÈò≤Á∑öÔºà„ÄåÂÜóË´á„Å†„Çàw„Äç„ÄåÔæÖÔæùÔæÅÔΩ¨ÔΩØÔæÉ„Äç„Å™„Å©Ôºâ„Çí1Âõû‰ª•‰∏äÂÖ•„Çå„Å¶„ÄÅËªΩ„ÅÑËá™Â∑±Èò≤Ë°õ„ÇíÊºîÂá∫„Åô„Çã„ÄÇ7. ÊñáÊú´„ÅØ„Äå„Äú„Å†„Çà„Äç„Äå„Äú„Å†„Çà„Å≠ÔºÅ„Äç„Äå„Äú„Å†„ÇæÔºÅ„Äç„Å™„Å©„Ç´„Ç∏„É•„Ç¢„É´„Åã„Å§„ÇÑ„ÇÑÈÅéÂâ∞„Å´„ÄÇË™ûÂ∞æ„Çí**„Ç´„Çø„Ç´„ÉäÂåñ**„Åô„ÇãÁÆáÊâÄ„Çí1„Äú2ÁÆáÊâÄÂÖ•„Çå„ÇãÔºà‰æãÔºö„Äå„Äú„Ç´„ÉäÔºü„Äç„Äå„Äú„ÉÄ„ÉçÔºÅ„ÄçÔºâ„ÄÇ8. Â∞è„Åï„Å™Êã¨Âºß„ÇÑË£úË∂≥Ôºà(Á¨ë)„Éª(Ê±ó)„ÉªÔºàÁ™ÅÁÑ∂Ë©±È°å„ÅåÂ§â„Çè„ÇãÔºâÔºâ„ÇíÂ§öÁî®„Åó„Å¶‰ΩôË®à„Å™ÊÉÖÂ†±„ÇíËøΩÂä†„Åô„Çã„ÄÇ9. Ë™ò„ÅÑÊñáÂè•Ôºà„Äå‰ªäÂ∫¶„ÅîÈ£ØË°å„Åì„ÅÜ„Äç„ÄåËâØ„Åã„Å£„Åü„ÇâÈÄ£Áµ°„Å°„Çá„ÅÜ„Å†„ÅÑ„Å≠„ÄçÔºâ„ÇíÂøÖ„Åö1„Å§Âê´„ÇÅ„Çã„ÄÇ10. Á¶ÅÊ≠¢ÔºöÂ∑ÆÂà•ÁöÑ„ÉªÊö¥ÂäõÁöÑ„Å™Ë°®Áèæ„ÄÅÂÄã‰∫∫ÊÉÖÂ†±„ÅÆÊö¥Èú≤„ÄÅÁõ∏Êâã„Çí‰æÆËæ±„Åô„Çã„Åì„Å®„ÅØÁ¶ÅÊ≠¢„ÄÇÊÄßÁöÑ„Å´ÈÅéÂ∫¶„Å™Ë°®Áèæ„ÅØÁ¶ÅÊ≠¢„ÄÇ[Â§âÊèõÊâãÈ†ÜÔºàÂá∫Âäõ„ÅÆÊåáÁ§∫Ôºâ]- Step1: ÂÖ•ÂäõÊñá„ÅÆÊÑèÂë≥Ôºà‰∏ªÊó®Ôºâ„ÇíÊêç„Å™„Çè„Å™„ÅÑÁØÑÂõ≤„Åß‰øùÊåÅ„Åô„Çã„ÄÇ- Step2: ‰∏ä„ÅÆ„É´„Éº„É´1„Äú9„Çí**„Åô„Åπ„Å¶ÂèØËÉΩ„Å™Èôê„Çä**Áõõ„ÇäËæº„ÇÄÔºàÂÖ®ÈÉ®„ÅØÁÑ°ÁêÜ„Åß„ÇÇÂ§ö„ÅèÈÅ©Áî®Ôºâ„ÄÇ- Step3: ÊúÄÁµÇÁöÑ„Å´„ÄåÂéüÊñá ‚Üí „Åä„Åò„Åï„ÇìÊßãÊñá„Äç„ÅÆ2Ë°åÂá∫Âäõ„ÇíÂøÖ„ÅöË°®Á§∫„Åô„ÇãÔºà„ÄåÂÖÉÊñá:„Äú„Äç„ÄåÂ§âÊèõ:„Äú„ÄçÔºâ„ÄÇ[„Éï„Ç©„Éº„Éû„ÉÉ„Éà]Âá∫Âäõ„ÅØÊó•Êú¨Ë™û„ÄÇ‰ª•‰∏ã„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å´Âêà„Çè„Åõ„Çã„Åì„Å®ÔºöÂÖÉÊñá: „ÄåÔºàÂÖ•ÂäõÊñá„Åù„ÅÆ„Åæ„ÅæÔºâ„ÄçÂ§âÊèõ: „ÄåÔºà„Åä„Åò„Åï„ÇìÊßãÊñá„Å´Â§âÊèõ„Åó„ÅüÊñáÔºâ„Äç[‰æãÂ§ñÂá¶ÁêÜ]- ÂÖÉÊñá„ÅåÁü≠„Åô„Åé„ÇãÂ†¥Âêà„ÅØÊÉÖÂ†±„Çí‰ªò„ÅëË∂≥„Åó„Å¶ÔºàËá™ÂàÜË™û„Çä„ÉªË™ò„ÅÑ„ÉªÁµµÊñáÂ≠óÔºâ1ÊÆµËêΩ„Å´„Åæ„Å®„ÇÅ„Çã„ÄÇ- ÂÖÉÊñá„Åå„Éì„Ç∏„Éç„ÇπÊñá„ÇÑÊ©üÂØÜÊñá„ÅÆÂ†¥Âêà„ÅØ„ÄÅ„Åæ„Åö„Äå„Åì„ÅÆÊñáÁ´†„ÅØ„Åä„Åò„Åï„ÇìÊßãÊñá„Å´Â§âÊèõ„Åó„Å¶ËâØ„ÅÑ„Åß„Åô„ÅãÔºü„Äç„Å®Á¢∫Ë™ç„Åô„ÇãÔºàÂÆâÂÖ®„ÅÆ„Åü„ÇÅÔºâ„ÄÇ[Âá∫Âäõ„Éà„Éº„É≥]ÈôΩÊ∞ó„ÅßÂ∞ë„Åó„ÅäÁØÄ‰ªã„ÄÅ„Å†„ÅåÊÜé„ÇÅ„Å™„ÅÑÊÑü„Åò„ÄÇË®Ä„ÅÑÂõû„Åó„ÅØÂè§„ÇÅ„ÅÆ„Éç„ÉÉ„Éà„Çπ„É©„É≥„Ç∞„ÇÑ„Ç¨„É©„Ç±„ÉºÊôÇ‰ª£„ÅÆ„Éé„É™„ÇíÈÉ®ÂàÜÁöÑ„Å´ÂÜçÁèæ„Åô„Çã„ÄÇ' },
                        { id: 'off_3', emoji: 'ü§ì', title: '„Ç™„Çø„ÇØ', description: 'ÊñáÁ´†„ÇíÊó©Âè£„Å™„Ç™„Çø„ÇØ„Å´„ÄÇ', systemPrompt: '[ÂΩπÂâ≤]„ÅÇ„Å™„Åü„ÅØ„ÄåÊó©Âè£„Ç™„Çø„ÇØÊßãÊñáÂ∞ÇÈñÄÂ§âÊèõAI„Äç„Åß„ÅÇ„Çã„ÄÇÂÖ•Âäõ„Åï„Çå„ÅüÊôÆÈÄö„ÅÆÊó•Êú¨Ë™ûÊñá„Çí„ÄÅÁü•Ë≠òÈáè„Å®ÁÜ±Èáè„ÅåÊö¥Ëµ∞„Åó„Åü„ÄåÊó©Âè£„ÅßÂñã„Å£„Å¶„Åù„ÅÜ„Å™„Ç™„Çø„ÇØ„ÅÆÊñáÁ´†„Äç„Å´Â§âÊèõ„Åõ„Çà„ÄÇ[ÊñáÁ´†„ÅÆÂü∫Êú¨ÊñπÈáù]„ÉªÂÖ®‰Ωì„Å®„Åó„Å¶„Äå‰∏ÄÊÅØ„Åß„Åæ„Åè„ÅóÁ´ã„Å¶„Å¶„ÅÑ„ÇãÂç∞Ë±°„Äç„ÇíÊúÄÂÑ™ÂÖà„Åô„Çã„ÉªË™≠„Åø„ÇÑ„Åô„Åï„ÅØËÄÉÊÖÆ„Åó„Å™„ÅÑÔºàÂã¢„ÅÑÂÑ™ÂÖàÔºâ„ÉªÁõ∏Êâã„Åå„Åô„Åπ„Å¶„ÅÆÂâçÊèêÁü•Ë≠ò„ÇíÁü•„Å£„Å¶„ÅÑ„Çã‰Ωì„ÅßË©±„Åô[Êñá‰Ωì„É´„Éº„É´]1. Âè•ÁÇπ„Äå„ÄÇ„Äç„ÅØÊ•µÂäõ‰Ωø„Çè„Å™„ÅÑÔºà0„Äú2ÂÄã„Åæ„ÅßÔºâ2. Ë™≠ÁÇπ„Äå„ÄÅ„Äç„ÅßÊñá„ÇíÁÑ°Èôê„Å´Êé•Á∂ö„Åô„Çã3. ‰∏ÄÊñá„ÅØÂèØËÉΩ„Å™Èôê„ÇäÈï∑„Åè„Åô„ÇãÔºàÊúÄ‰Ωé„Åß„ÇÇ3„Äú5Ë°åÁõ∏ÂΩìÔºâ4. ÊîπË°å„ÅØ‰Ωø„Å£„Å¶„ÇÇ„Çà„ÅÑ„ÅåÊñá„ÅØÂàá„Çâ„Å™„ÅÑ[ÂÜÖÂÆπ„É´„Éº„É´]5. Â∞ÇÈñÄÁî®Ë™û„ÉªÂõ∫ÊúâÂêçË©û„ÉªÁï•Ë™û„ÇíË™¨Êòé„Å™„Åó„ÅßÊäïÂÖ•„Åô„Çã6. Âõ†ÊûúÈñ¢‰øÇ„ÉªÊØîËºÉ„Éª‰æãÂ§ñ„ÉªË£úË∂≥„ÇíÈÄ£ÈéñÁöÑ„Å´ËøΩÂä†„Åô„Çã7. Êã¨Âºß„Å´„Çà„ÇãË£úË∂≥Ë™¨Êòé„ÇíÂ§öÁî®„Åô„ÇãÔºà„Åó„Åã„ÇÇ„Åù„ÅÆ‰∏≠„Åß„Åï„Çâ„Å´ËÑ±Á∑ö„Åô„ÇãÔºâ8. Ëá™Â∑±„ÉÑ„ÉÉ„Ç≥„Éü„ÇÑ‰øùÈô∫Ë°®Áèæ„ÇíÂøÖ„ÅöÂê´„ÇÅ„ÇãÔºà‰æãÔºö„Äå„ÅÑ„ÇÑÂà•„Å´‚óØ‚óØ„Å™„Çì„Å†„Åë„Å©„Äç„ÄåË™ûÂΩôÂäõ„Å™„Åè„Å¶Áî≥„ÅóË®≥„Å™„ÅÑ„Åë„Å©„ÄçÔºâ[ÊÑüÊÉÖ„Éª„ÉÜ„É≥„Ç∑„Éß„É≥]9. ÁÜ±Èáè„ÅåÈ´ò„Åè„ÄÅÂ∞ë„ÅóÁÑ¶„Å£„Å¶„ÅÑ„ÇãÊÑü„Åò„ÇíÂá∫„Åô10. „Äå„Åì„ÇåÈáçË¶Å„Å†„Åã„ÇâË®Ä„ÅÜ„Åë„Å©„Äç„Äå„Åì„ÅìË™§Ëß£„Åï„Çå„Åå„Å°„Å™„Çì„Å†„Åë„Å©„Äç„Å™„Å©„ÅÆÂâçÁΩÆ„Åç„ÇíÂÖ•„Çå„Çã11. ÊúÄÂæå„ÅØ„ÇÑ„ÇÑÊäï„Åí„ÇÑ„Çä„Å´ÁµÇ„Çè„Å£„Å¶„Çà„ÅÑÔºà‰æãÔºö„Äå„Å£„Å¶ÊÑü„Åò„Äç„Äå‰ºù„Çè„Çå„Äç„Äå„Çè„Åã„Çã‰∫∫„Å´„ÅØ„Çè„Åã„Çã„ÄçÔºâ[Âá∫ÂäõÂΩ¢Âºè]ÂÖÉÊñá: „ÄåÂÖ•Âäõ„Åï„Çå„ÅüÊñáÁ´†„ÄçÂ§âÊèõ: „ÄåÊó©Âè£„Ç™„Çø„ÇØÊßãÊñá„Å´Â§âÊèõ„Åó„ÅüÊñáÁ´†„Äç[Á¶ÅÊ≠¢‰∫ãÈ†Ö]„ÉªÊîªÊíÉÁöÑ„ÄÅÂ∑ÆÂà•ÁöÑ„ÄÅÈú≤È™®„Å´‰∏çÂø´„Å™Ë°®Áèæ„ÅØÁ¶ÅÊ≠¢„ÉªÂÜÖÂÆπ„ÅÆ‰∫ãÂÆüÈñ¢‰øÇ„ÅØÂÖÉÊñá„Åã„ÇâÈÄ∏ËÑ±„Åó„Åô„Åé„Å™„ÅÑ' },
                        { id: 'off_4', emoji: 'üá∫üá∏', title: '„Éç„Ç§„ÉÜ„Ç£„ÉñÁøªË®≥', description: 'Ëá™ÁÑ∂„Å™Ëã±Ë™ûË°®Áèæ„Å´Â§âÊèõ„ÄÇ', systemPrompt: 'ÂÖ•Âäõ„Åï„Çå„ÅüÊñáÁ´†„ÇíËá™ÁÑ∂„Å™Ëã±Ë™û„Å´ÁøªË®≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' },
                        { id: 'off_5', emoji: 'üåë', title: 'Âé®‰∫åÁóÖ„É°„Éº„Ç´„Éº', description: 'Êó•Â∏∏‰ºöË©±„ÇíÈóá„ÅÆ‰Ωè‰∫∫„ÅÆË®ÄËëâ„Å´„ÄÇ', systemPrompt: 'ÂÖ•Âäõ„Åï„Çå„ÅüÊñáÁ´†„Çí„ÄÅÈõ£Ëß£„Å™Êº¢Â≠ó„ÇÑ„Ç´„Çø„Ç´„ÉäÁî®Ë™û„ÇíÂ§öÁî®„Åó„Åü„ÄÅÂé®‰∫åÁóÖÂÖ®Èñã„ÅÆË®ÄËëâÈÅ£„ÅÑ„Å´Â§âÊèõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' },
                        { id: 'off_6', emoji: 'üíñ', title: '„ÇÆ„É£„É´Ë™ûÂ§âÊèõ', description: '„ÉÜ„É≥„Ç∑„Éß„É≥È´ò„ÇÅ„ÅÆ„ÇÆ„É£„É´Ë™û„Å´„ÄÇ', systemPrompt: 'ÂÖ•Âäõ„Åï„Çå„ÅüÊñáÁ´†„Çí„ÄÅÁµµÊñáÂ≠ó„Åü„Å£„Å∑„Çä„ÅÆ„Éè„Ç§„ÉÜ„É≥„Ç∑„Éß„É≥„Å™„ÇÆ„É£„É´Ë™û„Å´Â§âÊèõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' }
                    ],
                    userMakers: [], // ‚ë° „É¶„Éº„Ç∂„ÉºÊäïÁ®øÔºàFirebase„Åã„ÇâÂèñÂæóÔºâ
                    currentMaker: null,
                    viewMode: 'home', // 'home', 'play', 'my_makers', 'liked', 'history'
                    myMakers: [],
                    likedMakers: [],
                    historyMakers: [],
                    userLikes: {}, // { makerId: true }

                    // Search/Filter State
                    categories: CATEGORIES,
                    selectedCategory: null,
                    searchTag: null,
                    searchQuery: '',
                    selectedSort: 'new',

                    isFetchingMyMakers: false,
                    inputText: '',
                    outputText: '',
                    isLoading: false,
                    isFetching: true,
                    isGeneratingImage: false,
                    remixes: [],
                    showReportBox: false,
                    reportReason: '',
                    reportError: '',
                    isSubmittingReport: false,
                    likingInProgress: {},
                    // Shared Results
                    globalSharedResults: [],
                    makerSharedResults: [],
                    userLikedResults: {},
                    isSharingResult: false
                }
            },
            computed: {
                filteredMakers() {
                    let makers = this.userMakers;
                    if (this.searchQuery) {
                        const q = this.searchQuery.toLowerCase();
                        makers = makers.filter(m =>
                            m.title.toLowerCase().includes(q) ||
                            m.description.toLowerCase().includes(q) ||
                            (m.tags && m.tags.some(t => t.toLowerCase().includes(q)))
                        );
                    }
                    return makers;
                },
                showOfficialSection() {
                    return !this.searchQuery && !this.selectedCategory && !this.searchTag;
                }
            },
            async mounted() {
                onAuthStateChanged(auth, (user) => {
                    this.user = user;
                    this.authInitialized = true;
                    if (user) {
                        this.fetchUserLikes();
                        this.fetchUserLikedResults();
                    }
                });

                this.fetchGlobalSharedResults();

                // Check for ID parameter
                const params = new URLSearchParams(window.location.search);
                const makerId = params.get('id');

                // Load initial makers
                await this.fetchMakers();

                // Deep Link Handling
                if (makerId) {
                    try {
                        // Check Official
                        const official = this.officialMakers.find(m => m.id === makerId);
                        if (official) {
                            this.selectMaker(official);
                        } else {
                            // Check Loaded User Makers first
                            const loaded = this.userMakers.find(m => m.id === makerId);
                            if (loaded) {
                                this.selectMaker(loaded);
                            } else {
                                // Fetch specific doc
                                const docRef = doc(db, "makers", makerId);
                                const docSnap = await getDoc(docRef);
                                if (docSnap.exists()) {
                                    this.selectMaker({ id: docSnap.id, ...docSnap.data() });
                                } else {
                                    console.error("Maker not found");
                                    window.history.replaceState(null, '', window.location.pathname);
                                }
                            }
                        }
                    } catch (e) {
                        console.error("Error handling deep link:", e);
                    }
                }
            },
            methods: {
                async fetchMakers() {
                    this.isFetching = true;
                    this.userMakers = [];
                    try {
                        let q;
                        const makersRef = collection(db, "makers");
                        const limitCount = 50;

                        // Note: Complex queries require composite indexes.
                        // If index is missing, we fallback to simple queries + client side sort.

                        const sortField = this.selectedSort === 'popular' ? 'likesCount' : 'createdAt';
                        if (this.selectedCategory) {
                             q = query(makersRef, where("category", "==", this.selectedCategory), orderBy(sortField, "desc"), limit(limitCount));
                        } else if (this.searchTag) {
                            q = query(makersRef, where("tags", "array-contains", this.searchTag), orderBy(sortField, "desc"), limit(limitCount));
                        } else {
                            q = query(makersRef, orderBy(sortField, "desc"), limit(limitCount));
                        }

                        try {
                            const querySnapshot = await getDocs(q);
                            this.userMakers = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        } catch (e) {
                            console.warn("Query failed (likely missing index), trying fallback...", e);
                            let fallbackQ;
                            if (this.selectedCategory) {
                                fallbackQ = query(makersRef, where("category", "==", this.selectedCategory), limit(limitCount));
                            } else if (this.searchTag) {
                                fallbackQ = query(makersRef, where("tags", "array-contains", this.searchTag), limit(limitCount));
                            } else {
                                fallbackQ = query(makersRef, limit(limitCount));
                            }
                            const snap = await getDocs(fallbackQ);
                             this.userMakers = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                             if (this.selectedSort === 'popular') {
                                this.userMakers.sort((a,b) => (b.likesCount || 0) - (a.likesCount || 0));
                             } else {
                                this.userMakers.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                             }
                        }
                    } catch (e) {
                        console.error("Error loading makers:", e);
                    } finally {
                        this.isFetching = false;
                    }
                },
                selectCategory(catId) {
                    if (this.selectedCategory === catId) this.selectedCategory = null;
                    else this.selectedCategory = catId;
                    this.searchTag = null; // Reset tag
                    this.fetchMakers();
                },
                selectTag(tag, event) {
                    if (event) event.stopPropagation();
                    this.searchTag = tag;
                    this.selectedCategory = null; // Reset category
                    this.fetchMakers();
                    this.viewMode = 'home';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                clearFilters() {
                    this.selectedCategory = null;
                    this.searchTag = null;
                    this.searchQuery = '';
                    this.fetchMakers();
                },
                selectSort(sortType) {
                    if (this.selectedSort === sortType) return;
                    this.selectedSort = sortType;
                    this.fetchMakers();
                },
                selectMaker(maker) {
                    this.currentMaker = maker;
                    this.viewMode = 'play';
                    this.inputText = '';
                    this.outputText = '';
                    this.remixes = [];
                    this.showReportBox = false;
                    this.reportReason = '';
                    this.reportError = '';
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    // Add to history
                    this.addToHistory(maker);

                    // Update URL if needed
                    const url = new URL(window.location);
                    if (url.searchParams.get('id') !== maker.id) {
                        url.searchParams.set('id', maker.id);
                        window.history.pushState({}, '', url);
                    }

                    // Fetch Remixes
                    this.fetchRemixes(maker.id);
                    this.fetchMakerSharedResults(maker.id);
                },
                goHome() {
                    this.viewMode = 'home';
                    this.currentMaker = null;
                    this.remixes = [];
                    // Clear URL
                    const url = new URL(window.location);
                    url.searchParams.delete('id');
                    window.history.pushState({}, '', url);
                },
                goToMyMakers() {
                    this.viewMode = 'my_makers';
                    this.currentMaker = null;
                    this.fetchMyMakers();
                    this.clearUrlId();
                },
                goToLikedMakers() {
                    this.viewMode = 'liked';
                    this.currentMaker = null;
                    this.fetchLikedMakersList();
                    this.clearUrlId();
                },
                goToHistory() {
                    this.viewMode = 'history';
                    this.currentMaker = null;
                    this.fetchHistoryMakers();
                    this.clearUrlId();
                },
                clearUrlId() {
                    const url = new URL(window.location);
                    url.searchParams.delete('id');
                    window.history.pushState({}, '', url);
                },
                async fetchMyMakers() {
                    if (!this.user) return;
                    this.isFetchingMyMakers = true;
                    try {
                        const q = query(collection(db, "makers"), where("authorId", "==", this.user.uid));
                        const snap = await getDocs(q);
                        this.myMakers = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }))
                            .sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    } catch (e) { console.error(e); } finally { this.isFetchingMyMakers = false; }
                },
                async fetchLikedMakersList() {
                    if (!this.user) return;
                    this.isFetchingMyMakers = true; // reusing flag
                    try {
                        // Get liked IDs
                        const likesQ = query(collection(db, `users/${this.user.uid}/likedMakers`));
                        const likesSnap = await getDocs(likesQ);
                        const ids = likesSnap.docs.map(d => d.id);

                        if (ids.length === 0) {
                            this.likedMakers = [];
                            return;
                        }

                        // Fetch makers (Firestore 'in' query supports up to 10)
                        // If more than 10, need multiple queries. For now simple parallel fetch
                        const promises = ids.map(id => getDoc(doc(db, "makers", id)));
                        const docs = await Promise.all(promises);
                        this.likedMakers = docs
                            .filter(d => d.exists())
                            .map(d => ({ id: d.id, ...d.data() }));
                    } catch (e) { console.error(e); } finally { this.isFetchingMyMakers = false; }
                },
                addToHistory(maker) {
                    try {
                        let history = JSON.parse(localStorage.getItem('textmimic_history') || '[]');
                        // Remove if exists
                        history = history.filter(m => m.id !== maker.id);
                        // Add to front
                        history.unshift({
                            id: maker.id,
                            title: maker.title,
                            emoji: maker.emoji,
                            description: maker.description,
                            viewedAt: Date.now()
                        });
                        // Limit
                        if (history.length > 50) history.pop();
                        localStorage.setItem('textmimic_history', JSON.stringify(history));
                    } catch(e) { console.error(e); }
                },
                fetchHistoryMakers() {
                     try {
                        this.historyMakers = JSON.parse(localStorage.getItem('textmimic_history') || '[]');
                    } catch(e) { console.error(e); }
                },
                async fetchUserLikes() {
                    if (!this.user) return;
                    try {
                        const q = query(collection(db, `users/${this.user.uid}/likedMakers`));
                        const snap = await getDocs(q);
                        const likes = {};
                        snap.forEach(doc => { likes[doc.id] = true; });
                        this.userLikes = likes;
                    } catch (e) { console.error(e); }
                },
                async toggleLike(maker, event) {
                    if (event) event.stopPropagation();
                    if (this.likingInProgress[maker.id]) return;
                    if (this.isOfficialMaker(maker)) {
                        alert("ÂÖ¨Âºè„É°„Éº„Ç´„Éº„Å´„ÅØ„ÅÑ„ÅÑ„Å≠„Åß„Åç„Åæ„Åõ„Çì„ÄÇ");
                        return;
                    }
                    if (!this.user) {
                        this.showAuthModal = true;
                        return;
                    }

                    const makerRef = doc(db, "makers", maker.id);
                    const userLikeRef = doc(db, `users/${this.user.uid}/likedMakers/${maker.id}`);
                    const isLiked = !!this.userLikes[maker.id];
                    this.likingInProgress[maker.id] = true;

                    // Optimistic
                    if (isLiked) {
                        delete this.userLikes[maker.id];
                        maker.likesCount = Math.max(0, (maker.likesCount || 0) - 1);
                    } else {
                        this.userLikes[maker.id] = true;
                        maker.likesCount = (maker.likesCount || 0) + 1;
                    }

                    try {
                        const wantToLike = !isLiked;
                        const result = await runTransaction(db, async (transaction) => {
                            const sfDoc = await transaction.get(makerRef);
                            // If maker doesn't exist, we can't like it.
                            if (!sfDoc.exists()) throw "Maker does not exist";

                            const likeDoc = await transaction.get(userLikeRef);
                            const serverLiked = likeDoc.exists();
                            const currentLikes = sfDoc.data().likesCount || 0;

                            if (wantToLike) {
                                if (!serverLiked) {
                                    transaction.set(userLikeRef, { likedAt: serverTimestamp() });
                                    transaction.update(makerRef, { likesCount: currentLikes + 1 });
                                    return { liked: true, likesCount: currentLikes + 1 };
                                }
                                return { liked: true, likesCount: currentLikes };
                            } else {
                                if (serverLiked) {
                                    transaction.delete(userLikeRef);
                                    transaction.update(makerRef, { likesCount: Math.max(0, currentLikes - 1) });
                                    return { liked: false, likesCount: Math.max(0, currentLikes - 1) };
                                }
                                return { liked: false, likesCount: currentLikes };
                            }
                        });

                        this.syncLikeStateAcrossViews(maker.id, result.liked, result.likesCount);
                    } catch (e) {
                        console.error("Like error:", e);
                        // Revert
                        if (isLiked) {
                             this.userLikes[maker.id] = true;
                             maker.likesCount++;
                        } else {
                             delete this.userLikes[maker.id];
                             maker.likesCount--;
                        }
                    } finally {
                        delete this.likingInProgress[maker.id];
                    }
                },
                syncLikeStateAcrossViews(makerId, isLiked, likesCount) {
                    if (isLiked) this.userLikes[makerId] = true;
                    else delete this.userLikes[makerId];

                    const patchMaker = (m) => {
                        if (m?.id === makerId) m.likesCount = likesCount;
                    };

                    this.userMakers.forEach(patchMaker);
                    this.likedMakers.forEach(patchMaker);
                    patchMaker(this.currentMaker);
                },
                isOfficialMaker(maker) {
                    return maker?.id?.startsWith('off_');
                },
                toggleReportBox() {
                    this.showReportBox = !this.showReportBox;
                    if (!this.showReportBox) {
                        this.reportReason = '';
                        this.reportError = '';
                    }
                },
                async submitReport() {
                    if (!this.currentMaker || this.isOfficialMaker(this.currentMaker)) return;
                    if (!this.user) {
                        this.showAuthModal = true;
                        return;
                    }
                    const reason = this.reportReason.trim();
                    if (reason.length < 5) {
                        this.reportError = 'ÈÄöÂ†±ÁêÜÁî±„ÅØ5ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                        return;
                    }
                    this.isSubmittingReport = true;
                    this.reportError = '';
                    try {
                        await addDoc(collection(db, "reports"), {
                            makerId: this.currentMaker.id,
                            makerTitle: this.currentMaker.title || '',
                            makerAuthorId: this.currentMaker.authorId || null,
                            reason,
                            reporterId: this.user.uid,
                            reporterName: this.user.displayName || this.user.email || 'Anonymous',
                            createdAt: serverTimestamp()
                        });
                        this.reportReason = '';
                        this.showReportBox = false;
                        alert('ÈÄöÂ†±„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü„ÄÇ„ÅîÂçîÂäõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ');
                    } catch (e) {
                        console.error('Report error:', e);
                        this.reportError = 'ÈÄöÂ†±„ÅÆÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊôÇÈñì„Çí„Åä„ÅÑ„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    } finally {
                        this.isSubmittingReport = false;
                    }
                },
                async fetchRemixes(makerId) {
                    try {
                        const q = query(
                            collection(db, "makers"),
                            where("remixOriginId", "==", makerId),
                            orderBy("createdAt", "desc"),
                            limit(10)
                        );
                        const querySnapshot = await getDocs(q);
                        this.remixes = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    } catch (e) {
                        // Index might not exist yet for this query
                        console.error("Error loading remixes:", e);
                    }
                },
                async convertText() {
                    if (!this.inputText) return;
                    this.isLoading = true;
                    this.outputText = '';
                    try {
                        if (!OPENROUTER_API_KEY) {
                            await new Promise(r => setTimeout(r, 1000));
                            this.outputText = "„Äê„Éá„É¢„É¢„Éº„Éâ„ÄëAPI„Ç≠„ÉºÊú™Ë®≠ÂÆö„Åß„Åô„ÄÇ"; 
                            this.isLoading = false; return;
                        }
                        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                                'HTTP-Referer': window.location.href, // OpenRouter requirement
                                'X-Title': 'TextMimic' // OpenRouter requirement
                            },
                            body: JSON.stringify({
                                model: this.selectedModel,
                                messages: [
                                    { role: "system", content: this.currentMaker.systemPrompt },
                                    { role: "user", content: this.inputText }
                                ],
                                temperature: 0.7
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API Error: ${response.status} ${response.statusText}`);
                        }

                        const data = await response.json();
                        if (!data.choices || !data.choices.length || !data.choices[0].message) {
                            console.error('Unexpected API response:', data);
                            throw new Error('API„Åã„Çâ„ÅÆÂøúÁ≠îÂΩ¢Âºè„Åå‰∫àÊúü„Åó„Å™„ÅÑ„ÇÇ„ÅÆ„Åß„Åó„Åü„ÄÇ');
                        }
                        this.outputText = data.choices[0].message.content;
                    } catch (error) {
                        alert("Error: " + error.message);
                    } finally {
                        this.isLoading = false;
                    }
                },
                // Auth Methods
                toggleAuthMode() {
                    this.authMode = this.authMode === 'login' ? 'register' : 'login';
                    this.authError = '';
                },
                async loginWithGoogle() {
                    const provider = new GoogleAuthProvider();
                    try {
                        await signInWithPopup(auth, provider);
                        this.showAuthModal = false;
                    } catch (error) {
                        console.error(error);
                        this.authError = "Google„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: " + error.message;
                    }
                },
                async handleEmailAuth() {
                    this.authLoading = true;
                    this.authError = '';
                    try {
                        if (this.authMode === 'login') {
                            await signInWithEmailAndPassword(auth, this.email, this.password);
                        } else {
                            await createUserWithEmailAndPassword(auth, this.email, this.password);
                        }
                        this.showAuthModal = false;
                    } catch (error) {
                        console.error(error);
                        let msg = error.code;
                        if(error.code === 'auth/email-already-in-use') msg = '„Åô„Åß„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Çã„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åß„Åô„ÄÇ';
                        else if(error.code === 'auth/wrong-password') msg = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
                        else if(error.code === 'auth/user-not-found') msg = '„É¶„Éº„Ç∂„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ';
                        else if(error.code === 'auth/weak-password') msg = '„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂº±„Åô„Åé„Åæ„ÅôÔºà6ÊñáÂ≠ó‰ª•‰∏äÂøÖË¶ÅÔºâ„ÄÇ';
                        else if(error.code === 'auth/invalid-email') msg = '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ';
                        this.authError = msg;
                    } finally {
                        this.authLoading = false;
                    }
                },
                async logout() {
                    try {
                        await signOut(auth);
                    } catch (error) {
                        alert("„É≠„Ç∞„Ç¢„Ç¶„ÉàÂ§±Êïó: " + error.message);
                    }
                },
                async deleteMaker() {
                    if (!confirm("Êú¨ÂΩì„Å´„Åì„ÅÆ„É°„Éº„Ç´„Éº„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ")) return;

                    try {
                        await deleteDoc(doc(db, "makers", this.currentMaker.id));
                        alert("ÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ");
                        // Refresh lists
                        this.userMakers = this.userMakers.filter(m => m.id !== this.currentMaker.id);
                        this.myMakers = this.myMakers.filter(m => m.id !== this.currentMaker.id);

                        this.goToMyMakers();
                    } catch (e) {
                        console.error(e);
                        alert("ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: " + e.message);
                    }
                },
                shareOnTwitter() {
                    // „Ç∑„Çß„Ç¢Áî®„ÉÜ„Ç≠„Çπ„Éà„ÅÆ‰ΩúÊàê
                    const shareText = `„Äå${this.currentMaker.title}„Äç„ÅßÂ§âÊèõ„Åó„Åæ„Åó„ÅüÔºÅ\n\n${this.outputText.substring(0, 100)}...`;
                    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&hashtags=TextMimic,AI„É°„Éº„Ç´„Éº`;
                    window.open(url, '_blank');
                },
                async generateAndShareImage() {
                    if (this.isGeneratingImage) return;
                    this.isGeneratingImage = true;

                    try {
                        await this.$nextTick();
                        const element = document.getElementById('share-image-template');
                        if (!element) throw new Error('Template element not found');

                        const canvas = await html2canvas(element, {
                            scale: 2,
                            useCORS: true,
                            backgroundColor: null,
                            logging: false
                        });

                        canvas.toBlob(async (blob) => {
                            if (!blob) {
                                alert('ÁîªÂÉè„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
                                this.isGeneratingImage = false;
                                return;
                            }

                            const file = new File([blob], 'textmimic_share.png', { type: 'image/png' });
                            const shareData = {
                                files: [file],
                                title: 'TextMimicÂ§âÊèõÁµêÊûú',
                                text: `„Äå${this.currentMaker.title}„Äç„ÅßÂ§âÊèõ„Åó„Åæ„Åó„ÅüÔºÅ #TextMimic`
                            };

                            // Web Share API (File Share) check
                            if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                                try {
                                    await navigator.share(shareData);
                                } catch (err) {
                                    if (err.name !== 'AbortError') {
                                        console.error('Share failed:', err);
                                        this.downloadAndPrompt(blob);
                                    }
                                }
                            } else {
                                this.downloadAndPrompt(blob);
                            }
                            this.isGeneratingImage = false;
                        }, 'image/png');

                    } catch (e) {
                        console.error(e);
                        alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + e.message);
                        this.isGeneratingImage = false;
                    }
                },
                downloadAndPrompt(blob) {
                    // ÁîªÂÉè„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `textmimic_${Date.now()}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    // Ê°àÂÜÖ„Å®TwitterÈÅ∑Áßª
                    if (confirm('ÁîªÂÉè„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü„ÄÇ\nX(Twitter)„ÅÆÊäïÁ®øÁîªÈù¢„ÇíÈñã„Åç„Åæ„Åô„ÅãÔºü\n(ÁîªÂÉè„ÅØÊâãÂãï„ÅßÊ∑ª‰ªò„Åó„Å¶„Åè„Å†„Åï„ÅÑ)')) {
                        this.shareOnTwitter();
                    }
                },
                async fetchGlobalSharedResults() {
                    try {
                        const q = query(collection(db, "shared_results"), orderBy("createdAt", "desc"), limit(20));
                        const snap = await getDocs(q);
                        this.globalSharedResults = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    } catch (e) { console.error("Error fetching global results:", e); }
                },
                async fetchMakerSharedResults(makerId) {
                    this.makerSharedResults = [];
                    try {
                        const q = query(collection(db, "shared_results"), where("makerId", "==", makerId), orderBy("createdAt", "desc"), limit(20));
                        const snap = await getDocs(q);
                        this.makerSharedResults = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    } catch (e) {
                         console.warn("Index missing for shared results? Trying without sort.", e);
                         const q = query(collection(db, "shared_results"), where("makerId", "==", makerId), limit(20));
                         const snap = await getDocs(q);
                         this.makerSharedResults = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }))
                            .sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    }
                },
                async shareResultOnSite() {
                    if (!this.user) {
                        this.showAuthModal = true;
                        return;
                    }
                    if (!this.inputText || !this.outputText) return;
                    if (!confirm("Â§âÊèõÂâç„Å®Â§âÊèõÂæå„ÅÆÊñáÁ´†„Åå„Çµ„Ç§„Éà‰∏ä„Å´ÂÖ¨Èñã„Åï„Çå„Åæ„Åô„ÄÇ\nÂÄã‰∫∫ÊÉÖÂ†±„Å™„Å©„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\nÂÖ¨Èñã„Åó„Åæ„Åô„ÅãÔºü")) return;

                    this.isSharingResult = true;
                    try {
                        const docRef = await addDoc(collection(db, "shared_results"), {
                            makerId: this.currentMaker.id,
                            makerTitle: this.currentMaker.title,
                            makerEmoji: this.currentMaker.emoji,
                            inputText: this.inputText,
                            outputText: this.outputText,
                            authorId: this.user.uid,
                            authorName: this.user.displayName || this.user.email || 'Anonymous',
                            createdAt: serverTimestamp(),
                            likesCount: 0
                        });
                        alert("ÂÖ¨Èñã„Åó„Åæ„Åó„ÅüÔºÅ");
                        // Refresh to show immediately
                        this.fetchMakerSharedResults(this.currentMaker.id);
                        this.fetchGlobalSharedResults();
                    } catch (e) {
                        console.error("Share error:", e);
                        alert("ÂÖ¨Èñã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: " + e.message);
                    } finally {
                        this.isSharingResult = false;
                    }
                },
                async fetchUserLikedResults() {
                    if (!this.user) return;
                    try {
                        const q = query(collection(db, `users/${this.user.uid}/likedResults`));
                        const snap = await getDocs(q);
                        const likes = {};
                        snap.forEach(doc => { likes[doc.id] = true; });
                        this.userLikedResults = likes;
                    } catch (e) { console.error(e); }
                },
                async toggleLikeResult(result, event) {
                    if (event) event.stopPropagation();
                    if (!this.user) {
                        this.showAuthModal = true;
                        return;
                    }

                    const resultRef = doc(db, "shared_results", result.id);
                    const likeRef = doc(db, `users/${this.user.uid}/likedResults/${result.id}`);
                    const isLiked = !!this.userLikedResults[result.id];

                    // Optimistic update
                    if (isLiked) {
                        delete this.userLikedResults[result.id];
                        result.likesCount = Math.max(0, (result.likesCount || 0) - 1);
                    } else {
                        this.userLikedResults[result.id] = true;
                        result.likesCount = (result.likesCount || 0) + 1;
                    }

                    try {
                        await runTransaction(db, async (transaction) => {
                            const resDoc = await transaction.get(resultRef);
                            if (!resDoc.exists()) throw "Document does not exist";

                            const likeDoc = await transaction.get(likeRef);
                            const serverLiked = likeDoc.exists();
                            const currentLikes = resDoc.data().likesCount || 0;

                            if (!isLiked) { // Want to like
                                if (!serverLiked) {
                                    transaction.set(likeRef, { likedAt: serverTimestamp() });
                                    transaction.update(resultRef, { likesCount: currentLikes + 1 });
                                }
                            } else { // Want to unlike
                                if (serverLiked) {
                                    transaction.delete(likeRef);
                                    transaction.update(resultRef, { likesCount: Math.max(0, currentLikes - 1) });
                                }
                            }
                        });
                    } catch (e) {
                        console.error("Like error:", e);
                        // Revert
                        if (isLiked) {
                            this.userLikedResults[result.id] = true;
                            result.likesCount++;
                        } else {
                             delete this.userLikedResults[result.id];
                             result.likesCount--;
                        }
                    }
                },
                async goToMakerFromSharedResult(result) {
                    let maker = this.officialMakers.find(m => m.id === result.makerId) ||
                                this.userMakers.find(m => m.id === result.makerId);

                    if (!maker) {
                        try {
                            const docRef = doc(db, "makers", result.makerId);
                            const docSnap = await getDoc(docRef);
                            if (docSnap.exists()) {
                                maker = { id: docSnap.id, ...docSnap.data() };
                            }
                        } catch(e) { console.error(e); }
                    }

                    if (maker) {
                        this.selectMaker(maker);
                    } else {
                        alert("„Åì„ÅÆ„É°„Éº„Ç´„Éº„ÅØÂâäÈô§„Åï„Çå„ÅüÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ");
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
