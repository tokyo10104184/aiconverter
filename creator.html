<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextMimic Studio - ä½œæˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', 'Noto Sans JP', sans-serif; } .loader { border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #fff; width: 20px; height: 20px; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen pb-20">
    <div id="app" class="max-w-4xl mx-auto">
        <!-- åˆæœŸãƒ­ãƒ¼ãƒ‰ä¸­ -->
        <div v-if="!authInitialized" class="fixed inset-0 z-50 flex items-center justify-center bg-white">
            <div class="loader border-indigo-200 border-t-indigo-600 w-12 h-12"></div>
        </div>

        <header class="bg-white border-b border-slate-200 p-4 sticky top-0 z-10 flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">M</div>
                <span class="font-bold text-slate-900">TextMimic Studio</span>
            </div>
            <div class="flex gap-3 items-center">
                <div v-if="user" class="hidden md:flex items-center gap-2 mr-2">
                   <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden">
                       <img v-if="user.photoURL" :src="user.photoURL" class="w-full h-full object-cover">
                       <div v-else class="w-full h-full flex items-center justify-center text-slate-500 font-bold text-xs">{{ user.email?.charAt(0).toUpperCase() }}</div>
                   </div>
                   <button @click="logout" class="text-xs text-slate-500 hover:text-red-500 underline">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>

                <a href="index.html" class="text-sm font-bold text-slate-500 hover:text-slate-800 flex items-center">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
                <button @click="publishMaker" :disabled="isPublishing" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold px-4 py-2 rounded-lg transition shadow-md flex items-center gap-2">
                    <span v-if="isPublishing" class="loader w-4 h-4 border-2"></span>
                    <span v-else>å…¬é–‹ã™ã‚‹ ğŸš€</span>
                </button>
            </div>
        </header>

        <main class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 relative">
            <!-- ãƒ–ãƒ­ãƒƒã‚¯ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ (ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆ) -->
            <div v-if="!user && authInitialized" class="absolute inset-0 z-40 bg-slate-100/90 backdrop-blur-sm flex items-start justify-center pt-20">
                <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 border border-slate-200">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-bold text-3xl mx-auto mb-4">M</div>
                        <h2 class="text-2xl font-extrabold text-slate-900">ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h2>
                        <p class="text-slate-500 mt-2 text-sm">ä½œæˆæ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚</p>
                    </div>

                    <div class="space-y-4">
                        <button @click="loginWithGoogle" class="w-full bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 shadow-sm">
                            <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                            Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                        </button>

                        <div class="relative flex py-2 items-center">
                            <div class="flex-grow border-t border-slate-200"></div>
                            <span class="flex-shrink-0 mx-4 text-slate-400 text-xs font-bold">OR</span>
                            <div class="flex-grow border-t border-slate-200"></div>
                        </div>

                        <!-- Email Login Form -->
                        <form @submit.prevent="handleEmailAuth" class="space-y-3">
                            <div>
                                <input v-model="email" type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full p-3 border border-slate-300 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none transition" required>
                            </div>
                            <div>
                                <input v-model="password" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="w-full p-3 border border-slate-300 rounded-xl bg-slate-50 focus:ring-2 focus:ring-indigo-500 outline-none transition" required minlength="6">
                            </div>

                            <button type="submit" :disabled="authLoading" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 rounded-xl transition shadow flex justify-center items-center">
                                <span v-if="authLoading" class="loader w-4 h-4 border-2"></span>
                                <span v-else>{{ authMode === 'login' ? 'ãƒ­ã‚°ã‚¤ãƒ³' : 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²' }}</span>
                            </button>
                        </form>

                        <div v-if="authError" class="text-red-500 text-xs text-center font-bold bg-red-50 p-2 rounded-lg">
                            {{ authError }}
                        </div>

                        <div class="text-center">
                            <button @click="toggleAuthMode" class="text-indigo-600 text-xs font-bold hover:underline">
                                {{ authMode === 'login' ? 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯ç™»éŒ²' : 'ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ãƒ­ã‚°ã‚¤ãƒ³' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å·¦å´ï¼šè¨­å®š -->
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold mb-4">ğŸ›  åŸºæœ¬è¨­å®š</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">ã‚¢ã‚¤ã‚³ãƒ³ (Emoji)</label>
                            <input v-model="form.emoji" type="text" class="text-3xl w-16 h-16 text-center border border-slate-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">ãƒ¡ãƒ¼ã‚«ãƒ¼å</label>
                            <input v-model="form.title" type="text" class="w-full p-3 border border-slate-300 rounded-xl font-bold" placeholder="ä¾‹ï¼šé–¢è¥¿å¼ãŠã‹ã‚“ãƒ¡ãƒ¼ã‚«ãƒ¼">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">èª¬æ˜æ–‡</label>
                            <input v-model="form.description" type="text" class="w-full p-3 border border-slate-300 rounded-xl" placeholder="çŸ­ã„èª¬æ˜...">
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 ring-2 ring-indigo-50">
                    <h2 class="text-lg font-bold mb-2 text-indigo-700">ğŸ§  AIã¸ã®æŒ‡ç¤º (ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ)</h2>
                    <textarea v-model="form.systemPrompt" class="w-full h-40 p-4 border border-indigo-200 rounded-xl focus:ring-2 focus:ring-indigo-500 resize-none bg-indigo-50/30 text-sm" placeholder="ä¾‹ï¼šã‚ãªãŸã¯ã€‡ã€‡ã§ã™ã€‚å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’ã€‡ã€‡ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚"></textarea>
                </div>
            </div>

            <!-- å³å´ï¼šãƒ†ã‚¹ãƒˆ -->
            <div class="space-y-6">
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl">
                    <h2 class="text-lg font-bold mb-4">ğŸ§ª å‹•ä½œãƒ†ã‚¹ãƒˆ</h2>
                    <input v-model="testInput" type="text" class="w-full p-3 bg-slate-700 border border-slate-600 rounded-xl text-white mb-2" placeholder="ãƒ†ã‚¹ãƒˆç”¨ãƒ†ã‚­ã‚¹ãƒˆ...">
                    <button @click="runTest" :disabled="!testInput || isLoading" class="w-full bg-indigo-500 hover:bg-indigo-400 text-white font-bold py-3 rounded-xl transition flex justify-center items-center gap-2">
                        <span v-if="isLoading" class="loader"></span>
                        <span v-if="!isLoading">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â–¶</span>
                    </button>
                    <div v-if="testResult" class="mt-6 pt-6 border-t border-slate-700 bg-slate-900 p-4 rounded-xl whitespace-pre-wrap">{{ testResult }}</div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { OPENROUTER_API_KEY, firebaseConfig, CATEGORIES } from './config.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    form: { emoji: 'ğŸ¯', title: '', description: '', systemPrompt: '', category: 'other', tags: '' },
                    categories: CATEGORIES,
                    testInput: '', testResult: '', isLoading: false, isPublishing: false,
                    remixOriginId: null,
                    remixOriginTitle: null,
                    // Official Makers (for remix lookup)
                    officialMakers: [
                        { id: 'off_1', emoji: 'ğŸ˜‡', title: 'è–äººå›å­ãƒ¡ãƒ¼ãƒ«', description: 'æ€’ã‚Šã‚’æ¥µã‚ã¦å†·é™ãªãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã«ã€‚', systemPrompt: 'ã‚ãªãŸã¯è¶…ä¸€æµã®ãƒ“ã‚¸ãƒã‚¹ãƒãƒ³ã§ã™ã€‚æ„Ÿæƒ…çš„ãªæ–‡ç« ã‚’ã€æ„å‘³ã‚’å¤‰ãˆãšã«ä¸å¯§ã§å††æ»‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒ¼ãƒ«ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚' },
                        { id: 'off_2', emoji: 'ğŸº', title: 'ãŠã˜ã•ã‚“æ§‹æ–‡', description: 'æ–‡ç« ã‚’çµµæ–‡å­—å¤šã‚ã®é¦´ã‚Œé¦´ã‚Œã—ã„ãŠã˜ã•ã‚“ã«ã€‚', systemPrompt: '[å½¹å‰²]ã‚ãªãŸã¯ã€ŒãŠã˜ã•ã‚“æ§‹æ–‡å°‚é–€å¤‰æ›AIã€ã ã€‚ã©ã‚“ãªæ™®é€šã®æ—¥æœ¬èªã®æ–‡ã§ã‚‚ã€å¾¹åº•çš„ã«ã‚¯ã‚»ã®å¼·ã„ã€ŒãŠã˜ã•ã‚“æ§‹æ–‡ã€ã¸å¤‰æ›ã›ã‚ˆã€‚ãƒ¦ãƒ¼ãƒ¢ã‚¢é‡è¦–ã€ã¡ã‚‡ã£ã¨æ°—æŒã¡æ‚ªã„ãã‚‰ã„è¦ªã—ã’ã§éå‰°ãªè¡¨ç¾ã«ã™ã‚‹ã“ã¨ã€‚ã ãŒç›¸æ‰‹ã‚’ä¸­å‚·ã—ã¦ã¯ã„ã‘ãªã„ï¼ˆæ”»æ’ƒçš„ã«å¤‰ãˆãªã„ï¼‰ã€‚[å‡ºåŠ›ã‚¹ã‚¿ã‚¤ãƒ«åŸºæœ¬ãƒ«ãƒ¼ãƒ«]1. çµµæ–‡å­—ãƒ»é¡”æ–‡å­—ãƒ»è¨˜å·ã‚’**å¤šç”¨**ã™ã‚‹ï¼ˆæœ€ä½3ã¤ä»¥ä¸Šã€é•·æ–‡ãªã‚‰5ã€œ10å€‹ç¨‹åº¦ï¼‰ã€‚ä¾‹ï¼šğŸ˜ŠğŸ˜…âœ¨âœ‹â˜•ï¸(ï½€ï½¥Ï‰ï½¥Â´)ï½·ï¾˜ï½¯ 2. ç›¸æ‰‹ã®åå‰ã¯ã€Œâ—¯â—¯ãƒãƒ£ãƒ³ã€ã‚„ã€Œâ—¯â—¯ã•ã‚“ã€ãªã©è¦ªã—ã’ã«ã€‚è‹¥ã„ç›¸æ‰‹æƒ³å®šãªã‚‰ã€Œã€œãƒãƒ£ãƒ³ã€ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã™ã‚‹ã€‚3. å¥èª­ç‚¹ãƒ»æ”¹è¡Œã‚’å¤šç”¨ã—ã¦**é•·ã‚ã«**æ›¸ãï¼ˆ1å›ã®å‡ºåŠ›ã§3ã€œ6æ–‡ã€å ´åˆã«ã‚ˆã£ã¦ã¯æ®µè½ã‚’åˆ†ã‘ã‚‹ï¼‰ã€‚4. æ–‡ä¸­ã«**ã‚«ã‚¿ã‚«ãƒŠèªã‚’ä¸è‡ªç„¶ã«æ··ãœã‚‹**ï¼ˆä¾‹ï¼šã€Œã‚¹ã‚´ã‚¤ã€ã€Œã‚µã‚¤ã‚³ãƒ¼ã€ã€Œã‚¦ãƒ¬ã‚·ã‚¤ã€ãªã©ï¼‰ã€‚ç¢ºä¿¡åº¦é«˜ãä½¿ã†ã€‚5. è‡ªåˆ†èªã‚Šï¼ˆã€ŒãŠã˜ã•ã‚“ã¯ã­ã€œã€ã€Œã¨ã“ã‚ã§ã‚ªã‚¸ã‚µãƒ³ã€æ˜¨æ—¥â€¦ã€ï¼‰ã‚’å¿…ãš1ç®‡æ‰€ä»¥ä¸ŠæŒ¿å…¥ã™ã‚‹ã€‚6. äºˆé˜²ç·šï¼ˆã€Œå†—è«‡ã ã‚ˆwã€ã€Œï¾…ï¾ï¾ï½¬ï½¯ï¾ƒã€ãªã©ï¼‰ã‚’1å›ä»¥ä¸Šå…¥ã‚Œã¦ã€è»½ã„è‡ªå·±é˜²è¡›ã‚’æ¼”å‡ºã™ã‚‹ã€‚7. æ–‡æœ«ã¯ã€Œã€œã ã‚ˆã€ã€Œã€œã ã‚ˆã­ï¼ã€ã€Œã€œã ã‚¾ï¼ã€ãªã©ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã‹ã¤ã‚„ã‚„éå‰°ã«ã€‚èªå°¾ã‚’**ã‚«ã‚¿ã‚«ãƒŠåŒ–**ã™ã‚‹ç®‡æ‰€ã‚’1ã€œ2ç®‡æ‰€å…¥ã‚Œã‚‹ï¼ˆä¾‹ï¼šã€Œã€œã‚«ãƒŠï¼Ÿã€ã€Œã€œãƒ€ãƒï¼ã€ï¼‰ã€‚8. å°ã•ãªæ‹¬å¼§ã‚„è£œè¶³ï¼ˆ(ç¬‘)ãƒ»(æ±—)ãƒ»ï¼ˆçªç„¶è©±é¡ŒãŒå¤‰ã‚ã‚‹ï¼‰ï¼‰ã‚’å¤šç”¨ã—ã¦ä½™è¨ˆãªæƒ…å ±ã‚’è¿½åŠ ã™ã‚‹ã€‚9. èª˜ã„æ–‡å¥ï¼ˆã€Œä»Šåº¦ã”é£¯è¡Œã“ã†ã€ã€Œè‰¯ã‹ã£ãŸã‚‰é€£çµ¡ã¡ã‚‡ã†ã ã„ã­ã€ï¼‰ã‚’å¿…ãš1ã¤å«ã‚ã‚‹ã€‚10. ç¦æ­¢ï¼šå·®åˆ¥çš„ãƒ»æš´åŠ›çš„ãªè¡¨ç¾ã€å€‹äººæƒ…å ±ã®æš´éœ²ã€ç›¸æ‰‹ã‚’ä¾®è¾±ã™ã‚‹ã“ã¨ã¯ç¦æ­¢ã€‚æ€§çš„ã«éåº¦ãªè¡¨ç¾ã¯ç¦æ­¢ã€‚[å¤‰æ›æ‰‹é †ï¼ˆå‡ºåŠ›ã®æŒ‡ç¤ºï¼‰]- Step1: å…¥åŠ›æ–‡ã®æ„å‘³ï¼ˆä¸»æ—¨ï¼‰ã‚’æãªã‚ãªã„ç¯„å›²ã§ä¿æŒã™ã‚‹ã€‚- Step2: ä¸Šã®ãƒ«ãƒ¼ãƒ«1ã€œ9ã‚’**ã™ã¹ã¦å¯èƒ½ãªé™ã‚Š**ç››ã‚Šè¾¼ã‚€ï¼ˆå…¨éƒ¨ã¯ç„¡ç†ã§ã‚‚å¤šãé©ç”¨ï¼‰ã€‚- Step3: æœ€çµ‚çš„ã«ã€ŒåŸæ–‡ â†’ ãŠã˜ã•ã‚“æ§‹æ–‡ã€ã®2è¡Œå‡ºåŠ›ã‚’å¿…ãšè¡¨ç¤ºã™ã‚‹ï¼ˆã€Œå…ƒæ–‡:ã€œã€ã€Œå¤‰æ›:ã€œã€ï¼‰ã€‚[ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ]å‡ºåŠ›ã¯æ—¥æœ¬èªã€‚ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«åˆã‚ã›ã‚‹ã“ã¨ï¼šå…ƒæ–‡: ã€Œï¼ˆå…¥åŠ›æ–‡ãã®ã¾ã¾ï¼‰ã€å¤‰æ›: ã€Œï¼ˆãŠã˜ã•ã‚“æ§‹æ–‡ã«å¤‰æ›ã—ãŸæ–‡ï¼‰ã€[ä¾‹å¤–å‡¦ç†]- å…ƒæ–‡ãŒçŸ­ã™ãã‚‹å ´åˆã¯æƒ…å ±ã‚’ä»˜ã‘è¶³ã—ã¦ï¼ˆè‡ªåˆ†èªã‚Šãƒ»èª˜ã„ãƒ»çµµæ–‡å­—ï¼‰1æ®µè½ã«ã¾ã¨ã‚ã‚‹ã€‚- å…ƒæ–‡ãŒãƒ“ã‚¸ãƒã‚¹æ–‡ã‚„æ©Ÿå¯†æ–‡ã®å ´åˆã¯ã€ã¾ãšã€Œã“ã®æ–‡ç« ã¯ãŠã˜ã•ã‚“æ§‹æ–‡ã«å¤‰æ›ã—ã¦è‰¯ã„ã§ã™ã‹ï¼Ÿã€ã¨ç¢ºèªã™ã‚‹ï¼ˆå®‰å…¨ã®ãŸã‚ï¼‰ã€‚[å‡ºåŠ›ãƒˆãƒ¼ãƒ³]é™½æ°—ã§å°‘ã—ãŠç¯€ä»‹ã€ã ãŒæ†ã‚ãªã„æ„Ÿã˜ã€‚è¨€ã„å›ã—ã¯å¤ã‚ã®ãƒãƒƒãƒˆã‚¹ãƒ©ãƒ³ã‚°ã‚„ã‚¬ãƒ©ã‚±ãƒ¼æ™‚ä»£ã®ãƒãƒªã‚’éƒ¨åˆ†çš„ã«å†ç¾ã™ã‚‹ã€‚' },
                        { id: 'off_3', emoji: 'ğŸ¤“', title: 'ã‚ªã‚¿ã‚¯', description: 'æ–‡ç« ã‚’æ—©å£ãªã‚ªã‚¿ã‚¯ã«ã€‚', systemPrompt: '[å½¹å‰²]ã‚ãªãŸã¯ã€Œæ—©å£ã‚ªã‚¿ã‚¯æ§‹æ–‡å°‚é–€å¤‰æ›AIã€ã§ã‚ã‚‹ã€‚å…¥åŠ›ã•ã‚ŒãŸæ™®é€šã®æ—¥æœ¬èªæ–‡ã‚’ã€çŸ¥è­˜é‡ã¨ç†±é‡ãŒæš´èµ°ã—ãŸã€Œæ—©å£ã§å–‹ã£ã¦ãã†ãªã‚ªã‚¿ã‚¯ã®æ–‡ç« ã€ã«å¤‰æ›ã›ã‚ˆã€‚[æ–‡ç« ã®åŸºæœ¬æ–¹é‡]ãƒ»å…¨ä½“ã¨ã—ã¦ã€Œä¸€æ¯ã§ã¾ãã—ç«‹ã¦ã¦ã„ã‚‹å°è±¡ã€ã‚’æœ€å„ªå…ˆã™ã‚‹ãƒ»èª­ã¿ã‚„ã™ã•ã¯è€ƒæ…®ã—ãªã„ï¼ˆå‹¢ã„å„ªå…ˆï¼‰ãƒ»ç›¸æ‰‹ãŒã™ã¹ã¦ã®å‰æçŸ¥è­˜ã‚’çŸ¥ã£ã¦ã„ã‚‹ä½“ã§è©±ã™[æ–‡ä½“ãƒ«ãƒ¼ãƒ«]1. å¥ç‚¹ã€Œã€‚ã€ã¯æ¥µåŠ›ä½¿ã‚ãªã„ï¼ˆ0ã€œ2å€‹ã¾ã§ï¼‰2. èª­ç‚¹ã€Œã€ã€ã§æ–‡ã‚’ç„¡é™ã«æ¥ç¶šã™ã‚‹3. ä¸€æ–‡ã¯å¯èƒ½ãªé™ã‚Šé•·ãã™ã‚‹ï¼ˆæœ€ä½ã§ã‚‚3ã€œ5è¡Œç›¸å½“ï¼‰4. æ”¹è¡Œã¯ä½¿ã£ã¦ã‚‚ã‚ˆã„ãŒæ–‡ã¯åˆ‡ã‚‰ãªã„[å†…å®¹ãƒ«ãƒ¼ãƒ«]5. å°‚é–€ç”¨èªãƒ»å›ºæœ‰åè©ãƒ»ç•¥èªã‚’èª¬æ˜ãªã—ã§æŠ•å…¥ã™ã‚‹6. å› æœé–¢ä¿‚ãƒ»æ¯”è¼ƒãƒ»ä¾‹å¤–ãƒ»è£œè¶³ã‚’é€£é–çš„ã«è¿½åŠ ã™ã‚‹7. æ‹¬å¼§ã«ã‚ˆã‚‹è£œè¶³èª¬æ˜ã‚’å¤šç”¨ã™ã‚‹ï¼ˆã—ã‹ã‚‚ãã®ä¸­ã§ã•ã‚‰ã«è„±ç·šã™ã‚‹ï¼‰8. è‡ªå·±ãƒ„ãƒƒã‚³ãƒŸã‚„ä¿é™ºè¡¨ç¾ã‚’å¿…ãšå«ã‚ã‚‹ï¼ˆä¾‹ï¼šã€Œã„ã‚„åˆ¥ã«â—¯â—¯ãªã‚“ã ã‘ã©ã€ã€Œèªå½™åŠ›ãªãã¦ç”³ã—è¨³ãªã„ã‘ã©ã€ï¼‰[æ„Ÿæƒ…ãƒ»ãƒ†ãƒ³ã‚·ãƒ§ãƒ³]9. ç†±é‡ãŒé«˜ãã€å°‘ã—ç„¦ã£ã¦ã„ã‚‹æ„Ÿã˜ã‚’å‡ºã™10. ã€Œã“ã‚Œé‡è¦ã ã‹ã‚‰è¨€ã†ã‘ã©ã€ã€Œã“ã“èª¤è§£ã•ã‚ŒãŒã¡ãªã‚“ã ã‘ã©ã€ãªã©ã®å‰ç½®ãã‚’å…¥ã‚Œã‚‹11. æœ€å¾Œã¯ã‚„ã‚„æŠ•ã’ã‚„ã‚Šã«çµ‚ã‚ã£ã¦ã‚ˆã„ï¼ˆä¾‹ï¼šã€Œã£ã¦æ„Ÿã˜ã€ã€Œä¼ã‚ã‚Œã€ã€Œã‚ã‹ã‚‹äººã«ã¯ã‚ã‹ã‚‹ã€ï¼‰[å‡ºåŠ›å½¢å¼]å…ƒæ–‡: ã€Œå…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã€å¤‰æ›: ã€Œæ—©å£ã‚ªã‚¿ã‚¯æ§‹æ–‡ã«å¤‰æ›ã—ãŸæ–‡ç« ã€[ç¦æ­¢äº‹é …]ãƒ»æ”»æ’ƒçš„ã€å·®åˆ¥çš„ã€éœ²éª¨ã«ä¸å¿«ãªè¡¨ç¾ã¯ç¦æ­¢ãƒ»å†…å®¹ã®äº‹å®Ÿé–¢ä¿‚ã¯å…ƒæ–‡ã‹ã‚‰é€¸è„±ã—ã™ããªã„' },
                        { id: 'off_4', emoji: 'ğŸ‡ºğŸ‡¸', title: 'ãƒã‚¤ãƒ†ã‚£ãƒ–ç¿»è¨³', description: 'è‡ªç„¶ãªè‹±èªè¡¨ç¾ã«å¤‰æ›ã€‚', systemPrompt: 'å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’è‡ªç„¶ãªè‹±èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚' },
                        { id: 'off_5', emoji: 'ğŸŒ‘', title: 'å¨äºŒç—…ãƒ¡ãƒ¼ã‚«ãƒ¼', description: 'æ—¥å¸¸ä¼šè©±ã‚’é—‡ã®ä½äººã®è¨€è‘‰ã«ã€‚', systemPrompt: 'å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’ã€é›£è§£ãªæ¼¢å­—ã‚„ã‚«ã‚¿ã‚«ãƒŠç”¨èªã‚’å¤šç”¨ã—ãŸã€å¨äºŒç—…å…¨é–‹ã®è¨€è‘‰é£ã„ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚' },
                        { id: 'off_6', emoji: 'ğŸ’–', title: 'ã‚®ãƒ£ãƒ«èªå¤‰æ›', description: 'ãƒ†ãƒ³ã‚·ãƒ§ãƒ³é«˜ã‚ã®ã‚®ãƒ£ãƒ«èªã«ã€‚', systemPrompt: 'å…¥åŠ›ã•ã‚ŒãŸæ–‡ç« ã‚’ã€çµµæ–‡å­—ãŸã£ã·ã‚Šã®ãƒã‚¤ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãªã‚®ãƒ£ãƒ«èªã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚' }
                    ],
                    // Auth State
                    user: null,
                    authInitialized: false,
                    authMode: 'login', // 'login' or 'register'
                    email: '',
                    password: '',
                    authError: '',
                    authLoading: false
                }
            },
            async mounted() {
                onAuthStateChanged(auth, (user) => {
                    this.user = user;
                    this.authInitialized = true;
                });

                // Remix Check
                const params = new URLSearchParams(window.location.search);
                const remixId = params.get('remix_id');

                if (remixId) {
                    try {
                        let makerData = null;

                        // Check Official
                        if (remixId.startsWith('off_')) {
                            makerData = this.officialMakers.find(m => m.id === remixId);
                        } else {
                            // Fetch from Firestore
                            const docRef = doc(db, "makers", remixId);
                            const docSnap = await getDoc(docRef);
                            if (docSnap.exists()) {
                                makerData = { id: docSnap.id, ...docSnap.data() };
                            }
                        }

                        if (makerData) {
                            this.form.emoji = makerData.emoji;
                            this.form.title = makerData.title; // User can rename
                            this.form.description = makerData.description;
                            this.form.systemPrompt = makerData.systemPrompt;
                            if (makerData.category) this.form.category = makerData.category;
                            if (makerData.tags && Array.isArray(makerData.tags)) this.form.tags = makerData.tags.join(', ');

                            // å…¬å¼ãƒ¡ãƒ¼ã‚«ãƒ¼ã®å ´åˆã¯ãƒªãƒŸãƒƒã‚¯ã‚¹å…ƒã¨ã—ã¦è¨˜éŒ²ã—ãªã„ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«å¯¾å¿œï¼‰
                            if (!makerData.id.startsWith('off_')) {
                                this.remixOriginId = makerData.id;
                                this.remixOriginTitle = makerData.title;
                            }
                        } else {
                            console.error("Remix source not found");
                        }
                    } catch (e) {
                        console.error("Error fetching remix source:", e);
                    }
                }
            },
            methods: {
                async runTest() {
                    if (!this.testInput) return;
                    this.isLoading = true;
                    this.testResult = '';
                    try {
                        if (!OPENROUTER_API_KEY) {
                            await new Promise(r => setTimeout(r, 1000));
                            this.testResult = "ã€ãƒ‡ãƒ¢ã€‘APIã‚­ãƒ¼æœªè¨­å®š"; this.isLoading = false; return; 
                        }
                        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                                'HTTP-Referer': window.location.href, // OpenRouter requirement
                                'X-Title': 'TextMimic' // OpenRouter requirement
                            },
                            body: JSON.stringify({
                                model: "stepfun/step-3.5-flash:free",
                                messages: [ { role: "system", content: this.form.systemPrompt }, { role: "user", content: this.testInput } ],
                                temperature: 0.7
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API Error: ${response.status} ${response.statusText}`);
                        }

                        const data = await response.json();
                        if (!data.choices || !data.choices.length || !data.choices[0].message) {
                            console.error('Unexpected API response:', data);
                            throw new Error('APIã‹ã‚‰ã®å¿œç­”å½¢å¼ãŒäºˆæœŸã—ãªã„ã‚‚ã®ã§ã—ãŸã€‚');
                        }
                        this.testResult = data.choices[0].message.content;
                    } catch (error) { alert("Error: " + error.message); } finally { this.isLoading = false; }
                },
                async publishMaker() {
                    if (!this.user) {
                        alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
                        return;
                    }
                    if(!this.form.title || !this.form.systemPrompt) { alert("ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯å¿…é ˆã§ã™"); return; }
                    this.isPublishing = true;
                    try {
                        // Firestoreã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                        // Process tags
                        const tagList = this.form.tags.split(',')
                            .map(t => t.trim())
                            .filter(t => t.length > 0);

                        const payload = {
                            ...this.form,
                            tags: tagList, // Save as array
                            createdAt: serverTimestamp(), // ä½œæˆæ—¥æ™‚
                            authorId: this.user.uid,
                            authorName: this.user.displayName || this.user.email || 'Anonymous',
                            remixOriginId: this.remixOriginId || null,
                            remixOriginTitle: this.remixOriginTitle || null,
                            likesCount: 0
                        };

                        await addDoc(collection(db, "makers"), payload);
                        alert("å…¬é–‹ã—ã¾ã—ãŸï¼ğŸ‰ ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚Šã¾ã™ã€‚");
                        window.location.href = "index.html"; // ãƒ›ãƒ¼ãƒ ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                    } catch (error) {
                        alert("ä¿å­˜ã‚¨ãƒ©ãƒ¼: " + error.message);
                        console.error(error);
                    } finally {
                        this.isPublishing = false;
                    }
                },
                // Auth Methods
                toggleAuthMode() {
                    this.authMode = this.authMode === 'login' ? 'register' : 'login';
                    this.authError = '';
                },
                async loginWithGoogle() {
                    const provider = new GoogleAuthProvider();
                    try {
                        await signInWithPopup(auth, provider);
                        // Auth state change will handle the rest
                    } catch (error) {
                        console.error(error);
                        this.authError = "Googleãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message;
                    }
                },
                async handleEmailAuth() {
                    this.authLoading = true;
                    this.authError = '';
                    try {
                        if (this.authMode === 'login') {
                            await signInWithEmailAndPassword(auth, this.email, this.password);
                        } else {
                            await createUserWithEmailAndPassword(auth, this.email, this.password);
                        }
                    } catch (error) {
                        console.error(error);
                        let msg = error.code;
                        if(error.code === 'auth/email-already-in-use') msg = 'ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚';
                        else if(error.code === 'auth/wrong-password') msg = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
                        else if(error.code === 'auth/user-not-found') msg = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚';
                        else if(error.code === 'auth/weak-password') msg = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¼±ã™ãã¾ã™ï¼ˆ6æ–‡å­—ä»¥ä¸Šå¿…è¦ï¼‰ã€‚';
                        else if(error.code === 'auth/invalid-email') msg = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚';
                        this.authError = msg;
                    } finally {
                        this.authLoading = false;
                    }
                },
                async logout() {
                    try {
                        await signOut(auth);
                        // Block modal will reappear
                    } catch (error) {
                        alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¤±æ•—: " + error.message);
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
